<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="karl quinsland"><meta name=description content="California Electric Grid Regulators publish alerts indicating a pending blackout"><meta name=keywords content="personal,blog,developer"><meta name=twitter:card content="summary"><meta name=twitter:title content="RSS and Home Assistant: early warning for grid blackouts"><meta name=twitter:description content="California Electric Grid Regulators publish alerts indicating a pending blackout"><meta property="og:title" content="RSS and Home Assistant: early warning for grid blackouts"><meta property="og:description" content="California Electric Grid Regulators publish alerts indicating a pending blackout"><meta property="og:type" content="article"><meta property="og:url" content="https://karlquinsland.com/2020/08/rss-and-home-assistant-early-warning-for-grid-blackouts/"><meta property="article:published_time" content="2020-08-16T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-16T00:00:00+00:00"><base href=https://karlquinsland.com/2020/08/rss-and-home-assistant-early-warning-for-grid-blackouts/><title>RSS and Home Assistant: early warning for grid blackouts · karl</title><link rel=canonical href=https://karlquinsland.com/2020/08/rss-and-home-assistant-early-warning-for-grid-blackouts/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css integrity=sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://karlquinsland.com/css/coder.min.3219ef62ae52679b7a9c19043171c3cd9f523628c2a65f3ef247ee18836bc90b.css integrity="sha256-MhnvYq5SZ5t6nBkEMXHDzZ9SNijCpl8+8kfuGINryQs=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://karlquinsland.com/css/coder-dark.min.e78e80fc3a585a4d1c8fc7f58623b6ff852411e38431a9cd1792877ecaa160f6.css integrity="sha256-546A/DpYWk0cj8f1hiO2/4UkEeOEManNF5KHfsqhYPY=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://karlquinsland.com/css/custom.css><link rel=icon type=image/png href=https://karlquinsland.com/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://karlquinsland.com/img/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.79.0"></head><body class=colorscheme-auto><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://karlquinsland.com/>karl</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://karlquinsland.com/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://karlquinsland.com/resume/>Résumé</a></li><li class=navigation-item><a class=navigation-link href=https://karlquinsland.com/contact/>Contact</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>RSS and Home Assistant: early warning for grid blackouts</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2020-08-16T00:00:00Z>August 16, 2020</time></span>
<span class=reading-time><i class="fas fa-clock"></i>3-minute read</span></div><div class=tags><i class="fas fa-tag"></i><a href=https://karlquinsland.com/tags/home-assistant/>home assistant</a>
<span class=separator>•</span>
<a href=https://karlquinsland.com/tags/automation/>automation</a></div></div></header><div><p>California, like most of the West Coast, is currently in the middle of a prolonged and serious heat-wave. Record breaking temperatures results in a distribution grid stressed beyond it&rsquo;s abilities which guarantees blackouts.</p><p>The <a href=https://en.wikipedia.org/wiki/California_Independent_System_Operator>organization that oversees the electric grid</a> in California publishes RSS feeds for various types of grid related news and events. All the CA ISO RSS feeds are published <a href=http://www.caiso.com/Pages/GlobalRSS.aspx>here</a>, but the two feed that I&rsquo;m using are:</p><ul><li><a href=http://content.caiso.com/awe/noticeRSS.xml>http://content.caiso.com/awe/noticeRSS.xml</a></li><li><a href=http://content.caiso.com/awe/noticeflexRSS.xml>http://content.caiso.com/awe/noticeflexRSS.xml</a></li></ul><p>As energy demand ramps up, <code>flex</code> alerts are issued as a call to reduce energy consumption. If demand continues to rise <code>warnings</code> and, finally, <code>stage3</code> events are issued. A <code>warning</code> does not guarantee a <code>stage3</code> event, but a <code>stage3</code> event mans that blackouts are all but inevitable in the coming hours. The <em>exact</em> meaning of each alert type is outlined in <a href=https://www.caiso.com/Documents/SystemAlertsWarningsandEmergenciesFactSheet.pdf>this PDF</a>.</p><p>The <code>noticeRSS.xml</code> feed, has <em>early</em> warning notifications that look like this:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=font-weight:700>&lt;item&gt;</span>
\n
<span style=font-weight:700>&lt;title&gt;</span>NOTICE 202002440: CAISO Grid Warning Issued <span style=font-weight:700>&lt;/title&gt;</span>
\n
<span style=font-weight:700>&lt;link&gt;</span>http://www.caiso.com/awe/noticelog.html#202002440<span style=font-weight:700>&lt;/link&gt;</span>
\n
<span style=font-weight:700>&lt;description&gt;</span>Effective: 16-Aug-2020 12:00 PM Terminates: 16-Aug-2020 11:59 PM<span style=font-weight:700>&lt;/description&gt;</span>
\n
<span style=font-weight:700>&lt;/item&gt;</span>
</code></pre></div><p>Note: there&rsquo;s nothing wrong w/ your browser, the <code>\n</code> characters <em>are</em> in the actual feed. No matter, the <a href=https://github.com/home-assistant/core/tree/dev/homeassistant/components/feedreader>RSS parser</a> in Home Assistant <em>can</em> tolerate them.</p><p>I use the alerts/warnings to do a few simple tasks, but there&rsquo;s so much potential beyond the automation I currently have:</p><ul><li>bumps thermostats up by a few degrees to lighten demand*</li><li>re-schedule a few routine activities that are usually done in the evening to as soon as possible (cooking, for example)</li><li>notify me to immediately go check that the generator has fuel</li></ul><ul><li>Currently in &lsquo;unarmed&rsquo; mode as I tweak the logic driving the decision</li></ul><h2 id=how-to-do-it>How to do it</h2><p>Basically, add the two feeds above to the <a href=https://www.home-assistant.io/integrations/feedreader/>feedreader</a> integration and use the <code>feedreader</code> type of <a href=https://www.home-assistant.io/docs/automation/trigger/#event-trigger>event</a> to trigger your automation.</p><p>Somewhere in <code>configuration.yaml</code>, load the <code>feedreader</code> component.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=font-weight:700>feedreader</span>: !include feedreader/rss.yaml

</code></pre></div><p>and in the <code>feedreader/rss.yaml</code> file, add the URLs:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=font-weight:700>urls</span>:
  - http://content.caiso.com/awe/noticeRSS.xml
  - http://content.caiso.com/awe/noticeflexRSS.xml
<span style=font-style:italic># Pull down the feed 2x/ hour</span>
<span style=font-weight:700>scan_interval</span>:
  <span style=font-weight:700>minutes</span>: 30
</code></pre></div><p>Unfortunately, Home Assistant does not support setting the <code>scan_interval</code> per feed, so you&rsquo;ll have to figure out a happy middle ground if you&rsquo;ve already got a few RSS feeds you monitor. Likewise, don&rsquo;t pull the feed down excessively&mldr; I don&rsquo;t see a lot of evidence that the feed is cached well and the CA ISO does occasionally have to put banners on the top of their site saying that the site is under heavy load. Don&rsquo;t be the reason the site goes down because <em>you</em> wanted <strong>instant</strong> notification.</p><p>If you&rsquo;re not in a position to do any sophisticated automation based on the notification, it&rsquo;s still simple to fire off a notification to <em>manually</em> prepare:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=font-style:italic>##</span>
- <span style=font-weight:700>alias</span>: Notify when new Flex or Warning issued
  <span style=font-weight:700>trigger</span>:
    <span style=font-weight:700>platform</span>: event
    <span style=font-weight:700>event_type</span>: feedreader
  <span style=font-weight:700>action</span>:
    <span style=font-weight:700>service</span>: persistent_notification.create
    <span style=font-weight:700>data_template</span>:
      <span style=font-weight:700>notification_id</span>: <span style=font-style:italic>&#34;{{ trigger.event.data.title }}&#34;</span>
      <span style=font-weight:700>title</span>: <span style=font-style:italic>&#34;FlexAlert&#34;</span>
      <span style=font-weight:700>message</span>: &gt;<span style=font-style:italic>
</span><span style=font-style:italic>        {% set tokens = trigger.event.data.description.split(&#39; &#39;) %}
</span><span style=font-style:italic>        {% set start_str = &#34;{} {} {}&#34;.format(tokens[1], tokens[2], tokens[3]) %}
</span><span style=font-style:italic>        {% set start = strptime(start_str, &#39;%d-%b-%Y %I:%M %p&#39;) %}
</span><span style=font-style:italic>        {% set end_str = &#34;{} {} {}&#34;.format(tokens[5], tokens[6], tokens[7]) %}
</span><span style=font-style:italic>        {% set end = strptime(end_str, &#39;%d-%b-%Y %I:%M %p&#39;) %}
</span><span style=font-style:italic>        &#34;Heads up, electricity demand is likely to exceed production from {{ start.isoformat() }} to {{ end.isoformat() }}&#34;</span>        
</code></pre></div><p>Which should create a simple notification that&rsquo;ll look something like this:</p><figure><img src=https://karlquinsland.com/2020/08/rss-and-home-assistant-early-warning-for-grid-blackouts/images/notification.jpg alt="Ignore the sample text from my testing"><figcaption><p>Ignore the sample text from my testing</p></figcaption></figure><p>The <code>strptime</code> function yields <code>start</code> and <code>end</code> objects that can be manipulated further:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>{% set now = now() %}
{% if start.day &gt; now.day -%}
  It looks like demand will be high *tomorrow*
{%- endif %}
</code></pre></div><p>Happy automating.</p></div><footer></footer></article></section></div><footer class=footer><section class=container><p>¯\_(ツ)_/¯</p>©
2020
karl quinsland
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-173167356-1','auto');ga('send','pageview');}</script></footer></main><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-173167356-1','auto');ga('send','pageview');}</script></body></html>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>automation on karl</title><link>https://karlquinsland.com/tags/automation/</link><description>Recent content in automation on karl</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 16 Aug 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://karlquinsland.com/tags/automation/index.xml" rel="self" type="application/rss+xml"/><item><title>RSS and Home Assistant: early warning for grid blackouts</title><link>https://karlquinsland.com/2020/08/rss-and-home-assistant-early-warning-for-grid-blackouts/</link><pubDate>Sun, 16 Aug 2020 00:00:00 +0000</pubDate><guid>https://karlquinsland.com/2020/08/rss-and-home-assistant-early-warning-for-grid-blackouts/</guid><description>&lt;p>California, like most of the West Coast, is currently in the middle of a prolonged and serious heat-wave. Record breaking temperatures results in a distribution grid stressed beyond it&amp;rsquo;s abilities which guarantees blackouts.&lt;/p>
&lt;p>The &lt;a href="https://en.wikipedia.org/wiki/California_Independent_System_Operator">organization that oversees the electric grid&lt;/a> in California publishes RSS feeds for various types of grid related news and events. All the CA ISO RSS feeds are published &lt;a href="http://www.caiso.com/Pages/GlobalRSS.aspx">here&lt;/a>, but the two feed that I&amp;rsquo;m using are:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://content.caiso.com/awe/noticeRSS.xml">http://content.caiso.com/awe/noticeRSS.xml&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://content.caiso.com/awe/noticeflexRSS.xml">http://content.caiso.com/awe/noticeflexRSS.xml&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>As energy demand ramps up, &lt;code>flex&lt;/code> alerts are issued as a call to reduce energy consumption. If demand continues to rise &lt;code>warnings&lt;/code> and, finally, &lt;code>stage3&lt;/code> events are issued. A &lt;code>warning&lt;/code> does not guarantee a &lt;code>stage3&lt;/code> event, but a &lt;code>stage3&lt;/code> event mans that blackouts are all but inevitable in the coming hours. The &lt;em>exact&lt;/em> meaning of each alert type is outlined in &lt;a href="https://www.caiso.com/Documents/SystemAlertsWarningsandEmergenciesFactSheet.pdf">this PDF&lt;/a>.&lt;/p>
&lt;p>The &lt;code>noticeRSS.xml&lt;/code> feed, has &lt;em>early&lt;/em> warning notifications that look like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-xml" data-lang="xml">&lt;span style="font-weight:bold">&amp;lt;item&amp;gt;&lt;/span>
\n
&lt;span style="font-weight:bold">&amp;lt;title&amp;gt;&lt;/span>NOTICE 202002440: CAISO Grid Warning Issued &lt;span style="font-weight:bold">&amp;lt;/title&amp;gt;&lt;/span>
\n
&lt;span style="font-weight:bold">&amp;lt;link&amp;gt;&lt;/span>http://www.caiso.com/awe/noticelog.html#202002440&lt;span style="font-weight:bold">&amp;lt;/link&amp;gt;&lt;/span>
\n
&lt;span style="font-weight:bold">&amp;lt;description&amp;gt;&lt;/span>Effective: 16-Aug-2020 12:00 PM Terminates: 16-Aug-2020 11:59 PM&lt;span style="font-weight:bold">&amp;lt;/description&amp;gt;&lt;/span>
\n
&lt;span style="font-weight:bold">&amp;lt;/item&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Note: there&amp;rsquo;s nothing wrong w/ your browser, the &lt;code>\n&lt;/code> characters &lt;em>are&lt;/em> in the actual feed. No matter, the &lt;a href="https://github.com/home-assistant/core/tree/dev/homeassistant/components/feedreader">RSS parser&lt;/a> in Home Assistant &lt;em>can&lt;/em> tolerate them.&lt;/p>
&lt;p>I use the alerts/warnings to do a few simple tasks, but there&amp;rsquo;s so much potential beyond the automation I currently have:&lt;/p>
&lt;ul>
&lt;li>bumps thermostats up by a few degrees to lighten demand*&lt;/li>
&lt;li>re-schedule a few routine activities that are usually done in the evening to as soon as possible (cooking, for example)&lt;/li>
&lt;li>notify me to immediately go check that the generator has fuel&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>Currently in &amp;lsquo;unarmed&amp;rsquo; mode as I tweak the logic driving the decision&lt;/li>
&lt;/ul>
&lt;h2 id="how-to-do-it">How to do it&lt;/h2>
&lt;p>Basically, add the two feeds above to the &lt;a href="https://www.home-assistant.io/integrations/feedreader/">feedreader&lt;/a> integration and use the &lt;code>feedreader&lt;/code> type of &lt;a href="https://www.home-assistant.io/docs/automation/trigger/#event-trigger">event&lt;/a> to trigger your automation.&lt;/p>
&lt;p>Somewhere in &lt;code>configuration.yaml&lt;/code>, load the &lt;code>feedreader&lt;/code> component.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="font-weight:bold">feedreader&lt;/span>: !include feedreader/rss.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>and in the &lt;code>feedreader/rss.yaml&lt;/code> file, add the URLs:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="font-weight:bold">urls&lt;/span>:
- http://content.caiso.com/awe/noticeRSS.xml
- http://content.caiso.com/awe/noticeflexRSS.xml
&lt;span style="font-style:italic"># Pull down the feed 2x/ hour&lt;/span>
&lt;span style="font-weight:bold">scan_interval&lt;/span>:
&lt;span style="font-weight:bold">minutes&lt;/span>: 30
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Unfortunately, Home Assistant does not support setting the &lt;code>scan_interval&lt;/code> per feed, so you&amp;rsquo;ll have to figure out a happy middle ground if you&amp;rsquo;ve already got a few RSS feeds you monitor. Likewise, don&amp;rsquo;t pull the feed down excessively&amp;hellip; I don&amp;rsquo;t see a lot of evidence that the feed is cached well and the CA ISO does occasionally have to put banners on the top of their site saying that the site is under heavy load. Don&amp;rsquo;t be the reason the site goes down because &lt;em>you&lt;/em> wanted &lt;strong>instant&lt;/strong> notification.&lt;/p>
&lt;p>If you&amp;rsquo;re not in a position to do any sophisticated automation based on the notification, it&amp;rsquo;s still simple to fire off a notification to &lt;em>manually&lt;/em> prepare:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="font-style:italic">##&lt;/span>
- &lt;span style="font-weight:bold">alias&lt;/span>: Notify when new Flex or Warning issued
&lt;span style="font-weight:bold">trigger&lt;/span>:
&lt;span style="font-weight:bold">platform&lt;/span>: event
&lt;span style="font-weight:bold">event_type&lt;/span>: feedreader
&lt;span style="font-weight:bold">action&lt;/span>:
&lt;span style="font-weight:bold">service&lt;/span>: persistent_notification.create
&lt;span style="font-weight:bold">data_template&lt;/span>:
&lt;span style="font-weight:bold">notification_id&lt;/span>: &lt;span style="font-style:italic">&amp;#34;{{ trigger.event.data.title }}&amp;#34;&lt;/span>
&lt;span style="font-weight:bold">title&lt;/span>: &lt;span style="font-style:italic">&amp;#34;FlexAlert&amp;#34;&lt;/span>
&lt;span style="font-weight:bold">message&lt;/span>: &amp;gt;&lt;span style="font-style:italic">
&lt;/span>&lt;span style="font-style:italic"> {% set tokens = trigger.event.data.description.split(&amp;#39; &amp;#39;) %}
&lt;/span>&lt;span style="font-style:italic"> {% set start_str = &amp;#34;{} {} {}&amp;#34;.format(tokens[1], tokens[2], tokens[3]) %}
&lt;/span>&lt;span style="font-style:italic"> {% set start = strptime(start_str, &amp;#39;%d-%b-%Y %I:%M %p&amp;#39;) %}
&lt;/span>&lt;span style="font-style:italic"> {% set end_str = &amp;#34;{} {} {}&amp;#34;.format(tokens[5], tokens[6], tokens[7]) %}
&lt;/span>&lt;span style="font-style:italic"> {% set end = strptime(end_str, &amp;#39;%d-%b-%Y %I:%M %p&amp;#39;) %}
&lt;/span>&lt;span style="font-style:italic"> &amp;#34;Heads up, electricity demand is likely to exceed production from {{ start.isoformat() }} to {{ end.isoformat() }}&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Which should create a simple notification that&amp;rsquo;ll look something like this:&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/08/rss-and-home-assistant-early-warning-for-grid-blackouts/images/notification.jpg" alt="Ignore the sample text from my testing" />
&lt;figcaption>
&lt;p>
Ignore the sample text from my testing
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>The &lt;code>strptime&lt;/code> function yields &lt;code>start&lt;/code> and &lt;code>end&lt;/code> objects that can be manipulated further:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-fallback" data-lang="fallback">{% set now = now() %}
{% if start.day &amp;gt; now.day -%}
It looks like demand will be high *tomorrow*
{%- endif %}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Happy automating.&lt;/p></description></item><item><title>Announcing The Missing ToDoist Tools</title><link>https://karlquinsland.com/2020/07/announcing-the-missing-todoist-tools/</link><pubDate>Sun, 26 Jul 2020 00:00:00 +0000</pubDate><guid>https://karlquinsland.com/2020/07/announcing-the-missing-todoist-tools/</guid><description>&lt;h1 id="tmtdt-the-missing-todoist-tools-">TMTDT: The Missing ToDoist Tools 🎉&lt;/h1>
&lt;p>As the name implies, TMTDT started as a small collection of scripts that I used to augment ToDoist with features they can&amp;rsquo;t/won&amp;rsquo;t implement. It&amp;rsquo;s grown quite a bit since then.&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/announcing-the-missing-todoist-tools/images/demo.gif" alt="I don&amp;#39;t know how to make flashy demo gifs." />
&lt;figcaption>
&lt;p>
I don&amp;#39;t know how to make flashy demo gifs.
&lt;a href="#demo">
See the file driving the demo
&lt;/a>
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>Those scripts started as simple idea and quickly morphed into a creaky, but essential, tool. As more features were added it continued too morph into an unmaintainable mess. Untangling that mess was on my todo list but never a high priority partly because of issues TMTDT was designed to solve 🤦.&lt;/p>
&lt;p>I lost my day job right as the spring of 2020 &lt;a href="https://en.wikipedia.org/wiki/Stay-at-home_order#COVID-19_pandemic">shelter in place&lt;/a> order was put in place. TMTDT is certainly not how I &lt;em>thought&lt;/em> early summer was going to be spent, but a useful way nonetheless.&lt;/p>
&lt;p>One significant chunk of my newly-freed time and a lengthy re-write later, I had something that looked promising. After a &lt;em>lot&lt;/em> more work and some tinkering, I&amp;rsquo;ve got something that feels like far more than a hacky tool for personal use.&lt;/p>
&lt;h2 id="why">Why&lt;/h2>
&lt;p>Why not?&lt;/p>
&lt;p>I had several scripts that I would run on a regular basis to do things like:&lt;/p>
&lt;ul>
&lt;li>set up projects with multiple different types of templates based on things like the date&lt;/li>
&lt;li>fix typos i routinely made while &lt;a href="https://get.todoist.help/hc/en-us/articles/115001745265-Task-Quick-Add">quick adding&lt;/a> tasks.&lt;/li>
&lt;li>re-schedule certain daily tasks if they had been missed&lt;/li>
&lt;/ul>
&lt;p>No joke, I&amp;rsquo;d spend a &lt;em>lot&lt;/em> of time fixing typos, expanding ideas for a project into proper sub-tasks and sections and other routine administrative work:&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/announcing-the-missing-todoist-tools/images/time-report.jpg" alt="Representative of time spent during a typical week" />
&lt;figcaption>
&lt;p>
Representative of time spent during a typical week
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>In that specific week, I kept track of how 37 hours were spent. Of those 37, about 4 were spent on general Inbox review / process. At least 3 of those 4 were spent &lt;em>directly&lt;/em> on task triage. 3/37 is about 8%. With no full time day job - &lt;a href="https://karlquinsland.com/contact/">hire me&lt;/a> - that&amp;rsquo;s a fairly representative breakdown for a given week; some time planning the things, lots of time doing the things.&lt;/p>
&lt;p>What would you do with 8% of your time back each week?&lt;/p>
&lt;p>I&amp;rsquo;m kidding.&lt;/p>
&lt;p>We all know that I&amp;rsquo;m not getting any free time back from this.&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/announcing-the-missing-todoist-tools/images/xkcd-1319.png" />
&lt;figcaption>
&lt;p>
&lt;a href="https://xkcd.com/1319/">
Credit: XKCD #1319
&lt;/a>
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>I&amp;rsquo;ve written this software to suit my needs, but the decision to make it a bit more robust and featured before release is because I&amp;rsquo;ve noticed a few &amp;lsquo;new&amp;rsquo; tools to better augment ToDoist:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/Hoffelhas/autodoist">autodoist&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://chrome.google.com/webstore/detail/todoist-shortcuts-gmail-v/dehmghpdcahlffompjagejmgbcfahndp">shortcuts&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/6uhrmittag/taskbutler">taskbutler&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://planner-todo.web.app/">planner&lt;/a>. This is more of a UI, but it&amp;rsquo;s a &lt;strong>very&lt;/strong> pretty app.&lt;/li>
&lt;/ul>
&lt;p>And I&amp;rsquo;m genuinely curious about how other people will user it. I am always appreciative when somebody finds a smart way to save some time and shares their trick. I&amp;rsquo;m hoping somebody figures out how to use this tool in a way that I can learn from.&lt;/p>
&lt;p>An announcement post for TMTDT is now on &lt;a href="https://old.reddit.com/r/todoist/comments/hyfl3o/introducing_the_missing_todoist_tools_a/">/r/todoist&lt;/a>.&lt;/p>
&lt;h2 id="how">How&lt;/h2>
&lt;p>The code and some documentation can be found on &lt;a href="https://github.com/kquinsland/the-missing-todoist-tools">GitHub&lt;/a>.&lt;/p>
&lt;p>The demo gif at the top of this post illustrates a simple example, but more through (read: contrived) examples are included in the &lt;a href="https://github.com/kquinsland/the-missing-todoist-tools/tree/master/jobs/v1">jobs&lt;/a> directory.&lt;/p>
&lt;p>The short version:&lt;/p>
&lt;blockquote>
&lt;p>Scriptable tools for building jobs to manage a TooDoist account&lt;/p>
&lt;/blockquote>
&lt;p>Slightly longer version:&lt;/p>
&lt;blockquote>
&lt;p>Architecture inspired by Elastic Search&amp;rsquo;s &lt;a href="https://github.com/elastic/curator/tree/master/curator">Curator&lt;/a>. Functionality built for ToDoist.&lt;/p>
&lt;/blockquote>
&lt;h3 id="demo">Demo&lt;/h3>
&lt;p>The full set of &lt;a href="https://github.com/kquinsland/the-missing-todoist-tools/blob/master/jobs/demo/">resources for the demo are here&lt;/a>, but the &amp;lsquo;meaningful&amp;rsquo; parts are below:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">
&lt;span style="font-style:italic"># apply these labels...&lt;/span>
&lt;span style="font-weight:bold">labels&lt;/span>:
- &lt;span style="font-style:italic">&amp;#34;at_work&amp;#34;&lt;/span>
&lt;span style="font-style:italic"># to tasks that...&lt;/span>
&lt;span style="font-weight:bold">filters&lt;/span>:
- &lt;span style="font-weight:bold">filter&lt;/span>:
&lt;span style="font-style:italic"># Any task that...&lt;/span>
&lt;span style="font-weight:bold">task&lt;/span>:
&lt;span style="font-style:italic"># ... ends in &amp;#39;at work&amp;#39; or &amp;#39;the office&amp;#39;&lt;/span>
&lt;span style="font-weight:bold">content&lt;/span>:
&lt;span style="font-weight:bold">match&lt;/span>: &lt;span style="font-style:italic">&amp;#39;(at work$|at the office$)&amp;#39;&lt;/span>
&lt;span style="font-weight:bold">option&lt;/span>:
&lt;span style="font-style:italic"># remove portions of task content that match the query&lt;/span>
&lt;span style="font-weight:bold">mutate&lt;/span>: &lt;span style="font-weight:bold">Yes&lt;/span>
&lt;span style="font-style:italic"># *AND*&lt;/span>
&lt;span style="font-style:italic"># ... has no labels&lt;/span>
&lt;span style="font-weight:bold">labels&lt;/span>:
&lt;span style="font-weight:bold">absent&lt;/span>: &lt;span style="font-weight:bold">Yes&lt;/span>
&lt;span style="font-style:italic"># *AND*&lt;/span>
&lt;span style="font-style:italic"># ... is in this project&lt;/span>
&lt;span style="font-weight:bold">projects&lt;/span>:
&lt;span style="font-weight:bold">name&lt;/span>:
&lt;span style="font-weight:bold">match&lt;/span>: &lt;span style="font-style:italic">&amp;#39;Inbox&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>and&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">
&lt;span style="font-style:italic"># Create the projects...&lt;/span>
&lt;span style="font-weight:bold">projects&lt;/span>:
&lt;span style="font-style:italic"># ... as child projects of `Garage Sale 🏚️💵`&lt;/span>
- &lt;span style="font-weight:bold">parent&lt;/span>:
&lt;span style="font-weight:bold">project&lt;/span>: Garage Sale 🏚️💵
&lt;span style="font-style:italic"># ... populated with template tasks/sections&lt;/span>
&lt;span style="font-weight:bold">template&lt;/span>:
&lt;span style="font-weight:bold">file&lt;/span>: ./templates/garage-sale.csv
&lt;span style="font-style:italic"># where the name of the projects to create comes from ...&lt;/span>
&lt;span style="font-weight:bold">from&lt;/span>:
&lt;span style="font-weight:bold">filters&lt;/span>:
- &lt;span style="font-weight:bold">filter&lt;/span>:
&lt;span style="font-style:italic"># Any task that...&lt;/span>
&lt;span style="font-weight:bold">task&lt;/span>:
&lt;span style="font-weight:bold">content&lt;/span>:
&lt;span style="font-weight:bold">match&lt;/span>: &lt;span style="font-style:italic">&amp;#34;.&amp;#34;&lt;/span>
&lt;span style="font-weight:bold">option&lt;/span>:
&lt;span style="font-weight:bold">delete&lt;/span>: &lt;span style="font-weight:bold">yes&lt;/span>
&lt;span style="font-weight:bold">projects&lt;/span>:
&lt;span style="font-style:italic"># ... is in this project&lt;/span>
&lt;span style="font-weight:bold">name&lt;/span>:
&lt;span style="font-weight:bold">match&lt;/span>: &lt;span style="font-style:italic">&amp;#39;Garage Sale 🏚️💵&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>home-lab on karl</title><link>https://karlquinsland.com/categories/home-lab/</link><description>Recent content in home-lab on karl</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 27 Dec 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://karlquinsland.com/categories/home-lab/index.xml" rel="self" type="application/rss+xml"/><item><title>Monitoring APC AP7900 switched PDU with Prometheus and Grafana</title><link>https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/</link><pubDate>Sun, 27 Dec 2020 00:00:00 +0000</pubDate><guid>https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/</guid><description>&lt;p>The APC AP7900 is a 1U single phase PDU with 8 switchable outlets and a network interface. It&amp;rsquo;s been EoL&amp;rsquo;d and can be had for less than 20% of it&amp;rsquo;s original price on &lt;a href="https://www.ebay.com/sch/i.html?_nkw=AP7900">eBay&lt;/a>. The network interface is so underpowered tha it can&amp;rsquo;t &lt;a href="http://origin-faq.pro-face.com/resources/sites/PROFACE/content/live/FAQS/300000/FA300635/en_US/APC%20AP7000%20Series%20End%20of%20Life%20Notice.pdf">support any modern cryptographic ciphers&lt;/a>.&lt;/p>
&lt;p>So with that, here&amp;rsquo;s a revised copy of my notes from the process of getting the device reset, updated and monitored.&lt;/p>
&lt;h2 id="the-hardware">The Hardware&lt;/h2>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/images/ap7900.png" alt="marketing photo of AP7900" />
&lt;figcaption>
&lt;/figcaption>
&lt;/figure>
&lt;p>Unfortunately, there&amp;rsquo;s no &amp;ldquo;reset everything to defaults&amp;rdquo; button or button sequence on the PDU. The unit I purchased had been configured with a manual IP assignment so it wasn&amp;rsquo;t as straightforward as using an unfolded paperclip to press the reboot button at boot and wait for a successful DHCP negotiation. This process has been &lt;a href="https://dan.langille.org/2015/01/13/apc-pdu-ap7900-resetting-the-password/">covered before&lt;/a>, so I&amp;rsquo;ll omit it here. In short: connect to the local mgmt interface via the &lt;a href="https://pinoutguide.com/UPS/apc_smart_cable_pinout.shtml">serial port&lt;/a>, adjust the network configuration and other settings as needed.&lt;/p>
&lt;p>The firmware can be updated via FTP easily enough. The processor on the network interface is &lt;em>really&lt;/em> slow so allow for &lt;em>several minutes&lt;/em> between the bin file upload and the flashing to commence/end. I had to repeat this three times for each of the partitions / subsystem OSs.&lt;/p>
&lt;h2 id="the-metrics">The Metrics&lt;/h2>
&lt;p>Again, because the network interface has an ancient/slow CPU, any method that extracts metrics from the device must be light weight&amp;hellip; enter &lt;a href="https://en.wikipedia.org/wiki/Simple_Network_Management_Protocol">SNMP&lt;/a>.&lt;/p>
&lt;p>SNMP is quite old and cumbersome but there&amp;rsquo;s an &lt;a href="https://github.com/prometheus/snmp_exporter">exporter for prometheus&lt;/a> which, after some tedious configuration, can interface the complexity that is is legacy SNMP with prometheus.&lt;/p>
&lt;h3 id="generating-a-config">Generating a config&lt;/h3>
&lt;p>In short, SNMP identifies each setting/entity that can be monitored or set with a unique numerical ID. Each number is separated with a &lt;code>.&lt;/code> and represents a specific edge/vertex on the graph of all settings that device supports.&lt;/p>
&lt;p>So, a setting known as &lt;code>rPDUIdentDeviceLinetoLineVoltage&lt;/code> may be &amp;lsquo;read&amp;rsquo; at the following address: &lt;code>1.3.6.1.4.1.318.1.1.12.1.15.0&lt;/code>. So if you have a few hundred parameters to monitor, you&amp;rsquo;ll have a few hundred nondescript numerical paths. Keeping track of them all is a royal pain in the ass, even with &lt;a href="https://en.wikipedia.org/wiki/Management_information_base">lookup tables&lt;/a>; known as &amp;ldquo;MIB files&amp;rdquo;.&lt;/p>
&lt;p>Unfortunately, there&amp;rsquo;s no way around it; a map between the numerical paths and the &amp;lsquo;human friendly&amp;rsquo; names must be built so the prometheus exporter knows what to expose and how to categorize it.&lt;/p>
&lt;p>The exporter comes with &lt;a href="https://github.com/prometheus/snmp_exporter/tree/master/generator">generator&lt;/a> to make this process a bit easier, but the process of obtaining MIB files isn&amp;rsquo;t quite so straightforward.
I hit a few snags and below is an updated &lt;code>Dockerfile&lt;/code> that gave me a &lt;em>working&lt;/em> generator tool:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">FROM&lt;/span>&lt;span style="font-style:italic"> golang:latest&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># The `mibs` target in the Makefile does not run to completion on OSX.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># Somewhere, a `sed` command is run against some vendor&amp;#39;s MIB file that&amp;#39;s for hardware that I don&amp;#39;t want to target.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># I don&amp;#39;t have the patience to resolve those issues and i&amp;#39;d prefer that the _entire_ MIB parse and generate &lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># process be 100% contained in the container image anyways.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">#&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># There are a _variety_ of errors that cropped up when running `generator parse_errors`:&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">#&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - level=warn ts=2020-12-27T21:40:42.988Z caller=main.go:120 msg=&amp;#34;NetSNMP reported parse error(s)&amp;#34; errors=16924&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - Cannot find module (SNMPv2-SMI): At line 275 in mibs/apc-powernet-mib&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - Did not find &amp;#39;enterprises&amp;#39; in module #-1 (mibs/apc-powernet-mib)&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - Did not find &amp;#39;DisplayString&amp;#39; in module #-1 (mibs/apc-powernet-mib)&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - Unlinked OID in PowerNet-MIB: apc ::= { enterprises 318 }&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - Undefined identifier: enterprises near line 281 of mibs/apc-powernet-mib&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - Cannot adopt OID in PowerNet-MIB: atsInputEntry ::= { atsInputTable 1 }&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - &amp;lt;and hundreds more `Cannot adopt OID in PowerNet-MIB:` messages&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># - Bad operator (INTEGER): At line 73 in /usr/share/snmp/mibs/ietf/SNMPv2-PDU&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">#&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">#&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># After some searching, it appears that MIBs can refer to other MIBs and some set of &amp;#39;base&amp;#39; files is not present.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># Due to licensing, the Debian docker image that the generator is based on does NOT ship w/ them or the &lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># `snmp-mibs-downloader` tool which is used to fetch the base MIB files. This is easy enough to fix...&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># First, update the repos we&amp;#39;ll pull packaged from&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">RUN&lt;/span> echo &lt;span style="font-style:italic">&amp;#34;deb http://deb.debian.org/debian/ buster main contrib non-free&amp;#34;&lt;/span> | tee -a /etc/apt/sources.list &amp;amp;&amp;amp; &lt;span style="font-weight:bold;font-style:italic">\
&lt;/span>&lt;span style="font-weight:bold;font-style:italic">&lt;/span> echo &lt;span style="font-style:italic">&amp;#34;deb http://deb.debian.org/debian/ buster-updates main contrib non-free&amp;#34;&lt;/span> | tee -a /etc/apt/sources.list &amp;amp;&amp;amp; &lt;span style="font-weight:bold;font-style:italic">\
&lt;/span>&lt;span style="font-weight:bold;font-style:italic">&lt;/span> echo &lt;span style="font-style:italic">&amp;#34;deb http://security.debian.org/debian-security buster/updates main contrib non-free&amp;#34;&lt;/span> | tee -a /etc/apt/sources.list&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># Then we run the &amp;#39;original&amp;#39; set of commands, adding in the `snmp-mibs-downloader` package.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># As part of the post-install hook, snmp-mibs-downloader will fetch the base MIBs that appear to be&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># missing.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">RUN&lt;/span> apt-get update &amp;amp;&amp;amp; &lt;span style="font-weight:bold;font-style:italic">\
&lt;/span>&lt;span style="font-weight:bold;font-style:italic">&lt;/span> apt-get install -y libsnmp-dev p7zip-full snmp-mibs-downloader &amp;amp;&amp;amp; &lt;span style="font-weight:bold;font-style:italic">\
&lt;/span>&lt;span style="font-weight:bold;font-style:italic">&lt;/span> go get github.com/prometheus/snmp_exporter/generator &amp;amp;&amp;amp; &lt;span style="font-weight:bold;font-style:italic">\
&lt;/span>&lt;span style="font-weight:bold;font-style:italic">&lt;/span> cd /go/src/github.com/prometheus/snmp_exporter/generator &amp;amp;&amp;amp; &lt;span style="font-weight:bold;font-style:italic">\
&lt;/span>&lt;span style="font-weight:bold;font-style:italic">&lt;/span> go get -v . &amp;amp;&amp;amp; &lt;span style="font-weight:bold;font-style:italic">\
&lt;/span>&lt;span style="font-weight:bold;font-style:italic">&lt;/span> go install&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># To fix _this_ error:&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># Bad operator (INTEGER): At line 73 in /usr/share/snmp/mibs/ietf/SNMPv2-PDU&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">#&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># we install a &amp;#39;patched&amp;#39; version.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># src: https://serverfault.com/questions/936119/snmp-mibs-on-ubuntu-error-in-mibs&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">RUN&lt;/span> wget http://pastebin.com/raw.php?i=p3QyuXzZ -O /usr/share/snmp/mibs/ietf/SNMPv2-PDU&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># This command is not needed for generation, but IS needed for manual checking / use of `snmptranslate` within the&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># container. Add to the above RUN statement if needed.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># sed -i &amp;#34;s/^\(mibs *:\).*/#\1/&amp;#34; /etc/snmp/snmp.conf&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">#&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># It simply comments out the `mibs:` line in `/etc/snmp/snmp.conf`&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># The &amp;#39;stock&amp;#39; generator expects the output of `make mibs` to be mounted into /opt/mibs.&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># Since we are no longer relying on the `make` target, we must tell the generator binary&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># to look in all of the &amp;#39;system default&amp;#39; locations *as well as* /opt/mibs&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">WORKDIR&lt;/span>&lt;span style="font-style:italic"> &amp;#34;/opt&amp;#34;&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">ENTRYPOINT&lt;/span> [&lt;span style="font-style:italic">&amp;#34;/go/bin/generator&amp;#34;&lt;/span>]&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># Rather than do something like this on the CLI every time the container is run&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># `-e MIBDIRS=&amp;#34;/usr/share/snmp/mibs:/usr/share/snmp/mibs/iana:/usr/share/snmp/mibs/ietf:/opt/mibs&amp;#34;`&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic"># we do it here...&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-style:italic">##&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">ENV&lt;/span> MIBDIRS /usr/share/snmp/mibs:/usr/share/snmp/mibs/iana:/usr/share/snmp/mibs/ietf:/opt/mibs&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;span style="">&lt;/span>&lt;span style="font-weight:bold">CMD&lt;/span> [&lt;span style="font-style:italic">&amp;#34;generate&amp;#34;&lt;/span>]&lt;span style="">
&lt;/span>&lt;span style="">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>In short, ditch the &lt;code>make mibs&lt;/code> step from &lt;a href="https://github.com/prometheus/snmp_exporter/tree/master/generator#docker-users">here&lt;/a> and move it inside the &lt;code>docker build&lt;/code> step; fetch all the MIB files, patching those that need it. Tell the tool where to find them.&lt;/p>
&lt;p>For my needs, I only care about the total amount of power being distributed through the PDU so, of the hundreds of different parameters that can be monitored, I&amp;rsquo;m only interested in:&lt;/p>
&lt;ul>
&lt;li>Uptime&lt;/li>
&lt;li>Input Voltage&lt;/li>
&lt;li>Power in Watts and VoltAmps&lt;/li>
&lt;li>Percentage of used/remaining capacity&lt;/li>
&lt;/ul>
&lt;p>This makes for a simple generator config:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="font-style:italic"># See: https://github.com/prometheus/snmp_exporter/tree/master/generator&lt;/span>
&lt;span style="font-style:italic">##&lt;/span>
&lt;span style="font-weight:bold">modules&lt;/span>:
&lt;span style="font-style:italic"># APC/Schneider UPS Network Management Cards&lt;/span>
&lt;span style="font-style:italic">#&lt;/span>
&lt;span style="font-style:italic"># Note: older management cards only support SNMP v1 (AP9606 and&lt;/span>
&lt;span style="font-style:italic"># AP9607, possibly others). Older versions of the firmware may only&lt;/span>
&lt;span style="font-style:italic"># support v1 as well. If you only have newer cards you can switch to&lt;/span>
&lt;span style="font-style:italic"># version v2c or v3.&lt;/span>
&lt;span style="font-style:italic">#&lt;/span>
&lt;span style="font-style:italic"># The management cards have relatively slow processors so don&amp;#39;t poll&lt;/span>
&lt;span style="font-style:italic"># very often and give a generous timeout to prevent spurious&lt;/span>
&lt;span style="font-style:italic"># errors. Alternatively you can eliminate the interface polling (OIDs&lt;/span>
&lt;span style="font-style:italic"># beginning with 1.3.6.1.2.1) to reduce the time taken for polling.&lt;/span>
&lt;span style="font-style:italic">#&lt;/span>
&lt;span style="font-style:italic"># MIB: https://download.schneider-electric.com/files?p_File_Name=powernet426.mib&lt;/span>
&lt;span style="font-style:italic"># Guide: http://www.apc.com/salestools/ASTE-6Z5QEY/ASTE-6Z5QEY_R0_EN.pdf&lt;/span>
&lt;span style="font-style:italic"># Download site: http://www.apc.com/us/en/tools/download/index.cfm&lt;/span>
&lt;span style="font-style:italic">##&lt;/span>
&lt;span style="font-weight:bold">apcups&lt;/span>:
&lt;span style="font-style:italic"># Not 100% sure why, but APC firmware does not appear to properly authenticate with the&lt;/span>
&lt;span style="font-style:italic"># credentials that i&amp;#39;ve set through the web UI. I&amp;#39;ve disabled write/set via SNMP so &lt;/span>
&lt;span style="font-style:italic"># sticking w/ v2 (no auth) is fine.&lt;/span>
&lt;span style="font-weight:bold">version&lt;/span>: 2
&lt;span style="font-weight:bold">walk&lt;/span>:
&lt;span style="font-style:italic"># Don&amp;#39;t care about network stats on this guy...&lt;/span>
&lt;span style="font-style:italic"># - interfaces&lt;/span>
&lt;span style="font-style:italic">##&lt;/span>
&lt;span style="font-style:italic"># Do care about uptime, tho&lt;/span>
- sysUpTime
&lt;span style="font-style:italic">##&lt;/span>
&lt;span style="font-style:italic"># For reasons that I don&amp;#39;t understand, specifying the OID results in errors like this:&lt;/span>
&lt;span style="font-style:italic"># level=error caller=main.go:130 msg=&amp;#34;Error generating config netsnmp&amp;#34; err=&amp;#34;cannot find oid &amp;#39;.1.3.6.1.4.1.318.1.1.12.1.15.0&amp;#39; to walk&amp;#34;&lt;/span>
&lt;span style="font-style:italic"># But the path &amp;#39;.1.3.6.1.4.1.318.1.1.12.1.15.0&amp;#39; maps to rPDUIdentDeviceLinetoLineVoltage.0&lt;/span>
&lt;span style="font-style:italic"># So specify that by name and the error goes away :/&lt;/span>
&lt;span style="font-style:italic">##&lt;/span>
- rPDUIdentDeviceLinetoLineVoltage &lt;span style="font-style:italic"># .1.3.6.1.4.1.318.1.1.12.1.15.0&lt;/span>
- rPDUIdentDevicePowerWatts &lt;span style="font-style:italic"># .1.3.6.1.4.1.318.1.1.12.1.16.0&lt;/span>
- rPDUIdentDevicePowerVA &lt;span style="font-style:italic"># .1.3.6.1.4.1.318.1.1.12.1.18.0&lt;/span>
- rPDULoadStatusTable &lt;span style="font-style:italic"># .1.3.6.1.4.1.318.1.1.12.2.3.1&lt;/span>
&lt;span style="font-style:italic">##&lt;/span>
&lt;span style="font-style:italic"># From `rPDULoadStatusTable`, I can get `rPDULoadStatusLoad` and `rPDULoadStatusLoadState`&lt;/span>
&lt;span style="font-style:italic"># which represent the percentage capacity as a percentage and a &amp;#34;low, nominal, warn, critical&amp;#34; flag.&lt;/span>
&lt;span style="font-style:italic">#&lt;/span>
&lt;span style="font-style:italic"># Don&amp;#39;t need to resort to the `lookup` mechanism as the PDU has only one bank and can just extract the values&lt;/span>
&lt;span style="font-style:italic"># by referring to them explicitly below. This would likely change w/ a 2U PDU&lt;/span>
&lt;span style="font-style:italic"># Allows for adjustment to how various SNMP endpoints are parsed (as info about a device vs a moving metric)&lt;/span>
&lt;span style="font-style:italic"># See: https://github.com/prometheus/snmp_exporter/tree/master/generator#enumasinfo-and-enumasstateset&lt;/span>
&lt;span style="font-style:italic">##&lt;/span>
&lt;span style="font-weight:bold">overrides&lt;/span>:
&lt;span style="font-style:italic"># Should be a percentage of load&lt;/span>
&lt;span style="font-weight:bold">rPDULoadStatusLoad&lt;/span>:
&lt;span style="font-weight:bold">type&lt;/span>: gauge
&lt;span style="font-style:italic"># In addition to a numerical load percentage, also handy to have the characterization _of_ that load, too&lt;/span>
&lt;span style="font-style:italic"># In this case, the load can be characterized one of 4 ways:&lt;/span>
&lt;span style="font-style:italic"># phaseLoadNormal (1),phaseLoadLow (2),phaseLoadNearOverload (3),phaseLoadOverload (4)&lt;/span>
&lt;span style="font-weight:bold">rPDULoadStatusLoadState&lt;/span>:
&lt;span style="font-weight:bold">type&lt;/span>: EnumAsStateSet
&lt;span style="font-style:italic">##&lt;/span>
&lt;span style="font-style:italic"># There are a few &amp;#39;constants&amp;#39; that come from the table i don&amp;#39;t need to track, so we drop them :)&lt;/span>
&lt;span style="font-weight:bold">rPDULoadStatusBankNumber&lt;/span>:
&lt;span style="font-weight:bold">ignore&lt;/span>: &lt;span style="font-weight:bold">true&lt;/span>
&lt;span style="font-weight:bold">type&lt;/span>: EnumAsInfo
&lt;span style="font-weight:bold">rPDULoadStatusIndex&lt;/span>:
&lt;span style="font-weight:bold">ignore&lt;/span>: &lt;span style="font-weight:bold">true&lt;/span>
&lt;span style="font-weight:bold">type&lt;/span>: EnumAsInfo
&lt;span style="font-weight:bold">rPDULoadStatusPhaseNumber&lt;/span>:
&lt;span style="font-weight:bold">ignore&lt;/span>: &lt;span style="font-weight:bold">true&lt;/span>
&lt;span style="font-weight:bold">type&lt;/span>: EnumAsInfo
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The resulting &lt;code>snmp.yml&lt;/code> is quite brief:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="font-style:italic"># WARNING: This file was auto-generated using snmp_exporter generator, manual changes will be lost.&lt;/span>
&lt;span style="font-weight:bold">apcups&lt;/span>:
&lt;span style="font-weight:bold">walk&lt;/span>:
- 1.3.6.1.4.1.318.1.1.12.2.3.1
&lt;span style="font-weight:bold">get&lt;/span>:
- 1.3.6.1.2.1.1.3.0
- 1.3.6.1.4.1.318.1.1.12.1.15.0
- 1.3.6.1.4.1.318.1.1.12.1.16.0
- 1.3.6.1.4.1.318.1.1.12.1.18.0
&lt;span style="font-weight:bold">metrics&lt;/span>:
- &lt;span style="font-weight:bold">name&lt;/span>: sysUpTime
&lt;span style="font-weight:bold">oid&lt;/span>: 1.3.6.1.2.1.1.3
&lt;span style="font-weight:bold">type&lt;/span>: gauge
&lt;span style="font-weight:bold">help&lt;/span>: The time (in hundredths of a second) since the network management portion of the system was last re-initialized. - 1.3.6.1.2.1.1.3
- &lt;span style="font-weight:bold">name&lt;/span>: rPDUIdentDeviceLinetoLineVoltage
&lt;span style="font-weight:bold">oid&lt;/span>: 1.3.6.1.4.1.318.1.1.12.1.15
&lt;span style="font-weight:bold">type&lt;/span>: gauge
&lt;span style="font-weight:bold">help&lt;/span>: Getting/Setting this OID will return/set the Line to Line Voltage - 1.3.6.1.4.1.318.1.1.12.1.15
- &lt;span style="font-weight:bold">name&lt;/span>: rPDUIdentDevicePowerWatts
&lt;span style="font-weight:bold">oid&lt;/span>: 1.3.6.1.4.1.318.1.1.12.1.16
&lt;span style="font-weight:bold">type&lt;/span>: gauge
&lt;span style="font-weight:bold">help&lt;/span>: Getting this OID will return the Power in Watts. - 1.3.6.1.4.1.318.1.1.12.1.16
- &lt;span style="font-weight:bold">name&lt;/span>: rPDUIdentDevicePowerVA
&lt;span style="font-weight:bold">oid&lt;/span>: 1.3.6.1.4.1.318.1.1.12.1.18
&lt;span style="font-weight:bold">type&lt;/span>: gauge
&lt;span style="font-weight:bold">help&lt;/span>: Getting this OID will return the Power in VA. - 1.3.6.1.4.1.318.1.1.12.1.18
- &lt;span style="font-weight:bold">name&lt;/span>: rPDULoadStatusLoad
&lt;span style="font-weight:bold">oid&lt;/span>: 1.3.6.1.4.1.318.1.1.12.2.3.1.1.2
&lt;span style="font-weight:bold">type&lt;/span>: gauge
&lt;span style="font-weight:bold">help&lt;/span>: Getting this OID will return the phase/bank load measured in tenths of Amps. - 1.3.6.1.4.1.318.1.1.12.2.3.1.1.2
&lt;span style="font-weight:bold">indexes&lt;/span>:
- &lt;span style="font-weight:bold">labelname&lt;/span>: rPDULoadStatusIndex
&lt;span style="font-weight:bold">type&lt;/span>: EnumAsInfo
- &lt;span style="font-weight:bold">name&lt;/span>: rPDULoadStatusLoadState
&lt;span style="font-weight:bold">oid&lt;/span>: 1.3.6.1.4.1.318.1.1.12.2.3.1.1.3
&lt;span style="font-weight:bold">type&lt;/span>: EnumAsStateSet
&lt;span style="font-weight:bold">help&lt;/span>: Getting this OID will return the phase/bank load state - 1.3.6.1.4.1.318.1.1.12.2.3.1.1.3
&lt;span style="font-weight:bold">indexes&lt;/span>:
- &lt;span style="font-weight:bold">labelname&lt;/span>: rPDULoadStatusIndex
&lt;span style="font-weight:bold">type&lt;/span>: EnumAsInfo
&lt;span style="font-weight:bold">enum_values&lt;/span>:
&lt;span style="font-weight:bold">1&lt;/span>: phaseLoadNormal
&lt;span style="font-weight:bold">2&lt;/span>: phaseLoadLow
&lt;span style="font-weight:bold">3&lt;/span>: phaseLoadNearOverload
&lt;span style="font-weight:bold">4&lt;/span>: phaseLoadOverload
&lt;span style="font-weight:bold">version&lt;/span>: 2
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="the-dashboard">The Dashboard&lt;/h2>
&lt;p>Once metrics are making their way into prometheus, it&amp;rsquo;s only a bit of work to get a dashboard up and running.&lt;/p>
&lt;p>For sanity checking I fired up a load; a crypto-miner. See if you can spot when&amp;hellip; :).&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/images/grafana.png" alt="screenshot showing simple grafana dashboard consuming some of the PDU metrics" />
&lt;figcaption>
&lt;p>
Simple dashboard in grafana
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>The &lt;code>json&lt;/code> file for the dashboard is about 750 lines long, so rather than embed it, I&amp;rsquo;ve &lt;a href="#files">attached&lt;/a> it as a file; the sha1 hash of &lt;code>dashboard.json&lt;/code> is &lt;code>400edb0c4064068f12e17c2f1f0d6862d3b8d449&lt;/code>.&lt;/p>
&lt;h3 id="estimating-costs">estimating costs&lt;/h3>
&lt;p>The dashboard just multiplies the average Wattage by the average cost of a kWh and then scales that to fit a 24h window.&lt;/p>
&lt;p>The rate I pay for electricity changes based on the hour in which the power is used; about 40% of the week, my power costs a few cents per kWh more. The cost shown in the image above is a rough approximation based on my average power rate of around 12.5 cents per kWh. This rate can be adjusted with the &lt;code>avgkWH_Cost&lt;/code> variable, if needed.&lt;/p>
&lt;h2 id="files">Files&lt;/h2>
&lt;ul>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/images/ap7900.png">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/images/ap7900_hua86ef71d7c97469c72abcc8606f92a1f_30363_300x0_resize_box_2.png" width="300" height="300">
&lt;/a>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/files/dashboard.json">
&lt;i class="far fa-file-file-code">&lt;/i>
files/dashboard.json:
&lt;br>
&lt;small>sha1(dashboard.json): 400edb0c4064068f12e17c2f1f0d6862d3b8d449&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/images/grafana.png">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/12/monitoring-apc-ap7900-switched-pdu-with-prometheus-and-grafana/images/grafana_hu12e2e56abae7547e2e0002fa4ac227b7_229334_300x0_resize_box_2.png" width="300" height="147">
&lt;/a>
&lt;figcaption>
&lt;small>Simple dashboard in grafana&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;/ul></description></item><item><title>home lab: simple printable cable org</title><link>https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/</link><pubDate>Sat, 18 Jul 2020 00:00:00 +0000</pubDate><guid>https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/</guid><description>&lt;p>Quick / another &amp;ldquo;i made a thing!&amp;rdquo; post.&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/installed.jpg" alt="Picture showing designed parts deployed as intended (please ignore the lingering dust! 💨)" />
&lt;figcaption>
&lt;p>
Picture showing designed parts deployed as intended (please ignore the lingering dust! 💨)
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>I needed some horizontal / vertical cable rings for cat5 and power cables. I would have used the excellent &lt;a href="https://www.thingiverse.com/thing:3315960">1U Rackmount Cable Management Rings&lt;/a> by &lt;a href="https://www.thingiverse.com/boulwarek/about">boulwarek&lt;/a> except the hole spacing didn&amp;rsquo;t work for my application. I needed cable rings for the &amp;lsquo;front-to-back&amp;rsquo; braces which have distinct dimensions:&lt;/p>
&lt;ul>
&lt;li>holes needed to be spaced &lt;code>10.85mm&lt;/code> apart&lt;/li>
&lt;li>distance between center of screw is &lt;code>20.0mm&lt;/code>&lt;/li>
&lt;/ul>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/hole-dimensions.jpg" alt="Screenshot from Fusion360 showing dimensions between screw holes" />
&lt;figcaption>
&lt;p>
Screenshot from Fusion360 showing dimensions between screw holes
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;p>I made the rings slightly smaller as the horizontal / vertical runs I needed rings for do not carry more than a few cables.&lt;/p>
&lt;p>A similar copy of this post is on &lt;a href="https://www.thingiverse.com/thing:4546078">thingiverse&lt;/a> and &lt;a href="https://www.prusaprinters.org/prints/36851-server-rack-cable-org">prusaprinters&lt;/a> page.&lt;/p>
&lt;h2 id="printing">Printing&lt;/h2>
&lt;p>Theses are &amp;lsquo;function&amp;rsquo; parts, so the cheapest material and fastest settings work. No support material needed and minimal bridging with the suggested print orientation shown below.&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/suggested_print_orientation.jpg" alt="Screenshot showing suggested print bed arrangement" />
&lt;figcaption>
&lt;p>
Screenshot showing suggested print bed arrangement
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;h2 id="files">Files&lt;/h2>
&lt;p>For archive / posterity, all source files are included here. All files are licensed as &lt;a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike&lt;/a> (CC BY-NC-SA).&lt;/p>
&lt;ul>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/hole-dimensions.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/hole-dimensions_hu83b61487aa052e287a0d86e657470027_73623_300x0_resize_q75_box.jpg" width="300" height="232">
&lt;/a>
&lt;figcaption>
&lt;small>Screenshot from Fusion360 showing dimensions between screw holes&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/horizontal-model.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/horizontal-model_hu543f65d8397ef1c757ed8c5dd191bd79_44806_300x0_resize_q75_box.jpg" width="300" height="337">
&lt;/a>
&lt;figcaption>
&lt;small>Picture showing the CAD model for horizontal variant&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/installed.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/installed_hu8273af6dd11af8c1f0254ae91302bd85_877360_300x0_resize_q75_box.jpg" width="300" height="118">
&lt;/a>
&lt;figcaption>
&lt;small>Picture showing designed parts deployed as intended (please ignore the lingering dust! 💨)&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/models/combined.3mf">
&lt;i class="far fa-file-archive">&lt;/i>
models/combined.3mf:
&lt;small style="font-family:'Lucida Console', monospace">3mf&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/models/horizontal.f3d">
&lt;i class="far fa-file-">&lt;/i>
models/horizontal.f3d:
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/models/horizontal.stl">
&lt;i class="far fa-file-code">&lt;/i>
Horizontal STL:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/models/vertical.f3d">
&lt;i class="far fa-file-">&lt;/i>
models/vertical.f3d:
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/models/vertical.stl">
&lt;i class="far fa-file-code">&lt;/i>
Vertical STL:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/suggested_print_orientation.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/suggested_print_orientation_hud61f960f3afd79e64529ec719f59eb42_400356_300x0_resize_q75_box.jpg" width="300" height="207">
&lt;/a>
&lt;figcaption>
&lt;small>Screenshot showing suggested print bed arrangement&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/vertical-model.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-simple-printable-cable-org/images/vertical-model_hu17d82c0049c0096ab66a3dbcef39359e_44352_300x0_resize_q75_box.jpg" width="300" height="241">
&lt;/a>
&lt;figcaption>
&lt;small>Picture showing the CAD model for vertical variant&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;/ul></description></item><item><title>home lab: mini 'universal' patch panel</title><link>https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/</link><pubDate>Sun, 05 Jul 2020 00:00:00 +0000</pubDate><guid>https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/</guid><description>&lt;p>This is another brief &amp;ldquo;i made a thing!&amp;rdquo; posts.&lt;/p>
&lt;h2 id="version-2">Version 2&lt;/h2>
&lt;p>&lt;strong>Update 2020-12-12:&lt;/strong> I outgrew version 1! I needed a few more ports and didn&amp;rsquo;t have much time&amp;hellip; so I just scaled the part up to double the number of jacks. The links below and the thingiverse and prusaprinters links have been updated w/ the new STL files. Printing and attachment works exactly the same as with the 1x8 version. Rather than include the Fusion360 source, I have included a standard STEP file.&lt;/p>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/v2_installed_front.jpg" alt="Picture showing the new 2x8 keystone bracket installed on rack from the front." />
&lt;figcaption>
&lt;/figcaption>
&lt;/figure>
&lt;figure >
&lt;img src="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/v2_installed_rear.jpg" alt="Picture showing the new 2x8 keystone bracket installed on rack from the rear." />
&lt;figcaption>
&lt;p>
Yes, I do need to re-do the cable runs; they&amp;#39;re a mess
&lt;/p>
&lt;/figcaption>
&lt;/figure>
&lt;h2 id="what">What&lt;/h2>
&lt;p>Taking the side / rear of my rack off every time I needed to change which host(s) were connected to the monitor was starting to get old. Only recently did I realize that you can fit more than just RJ45 jacks in a &lt;a href="https://en.wikipedia.org/wiki/Keystone_module">Keystone Jack&lt;/a>. A few measurements, a quick search through thingiverse and some CAD time later, this is the result.&lt;/p>
&lt;p>The model is tailored to my specific rack, but should be easily adoptable to any other dimensions. Import the Fusion360 model and then edit the first sketch in the timeline as needed and adjust the &lt;code>pattern on line&lt;/code> step to adjust the number of keystone jacks.&lt;/p>
&lt;p>Of course, you can always just glue the print to whichever surface you need it mounted on as there&amp;rsquo;s plenty of broad/flat surface for adhesive if the two built-in screw holes won&amp;rsquo;t work!&lt;/p>
&lt;p>As is, the model has:&lt;/p>
&lt;ul>
&lt;li>8 jacks&lt;/li>
&lt;li>&lt;code>178.5mm&lt;/code> from &amp;lsquo;edge&amp;rsquo; to &amp;lsquo;edge&amp;rsquo; between the two screw holes&lt;/li>
&lt;li>&lt;code>6.5mm&lt;/code> diameter for the holes as my rack uses M6 screws.&lt;/li>
&lt;/ul>
&lt;p>Note: After printing the model you see in the pictures below, I added a small cutout which should make it easier to depress the clip on the &amp;lsquo;male&amp;rsquo; end of a keystone device from the &amp;lsquo;user facing&amp;rsquo; side as you&amp;rsquo;d typically find on a proper patch panel&lt;/p>
&lt;p>All in all, I&amp;rsquo;m quite happy with how it turned out: 8 jacks is more than enough for current and (projected!) future use. The only obvious improvement would be moving the numbers from the bottom to the top where there&amp;rsquo;s more room. As it is now, the perimeters around the numbers look a bit weird as they merge w/ the bottom edge that are flush w/ the rack and the top edges that are flush w/ the jacks.&lt;/p>
&lt;p>Many thanks to &lt;a href="https://www.thingiverse.com/belfers/about">&lt;code>belfers&lt;/code>&lt;/a> for the &lt;a href="https://www.thingiverse.com/thing:3150524">Keystone model&lt;/a>.&lt;/p>
&lt;p>The details are on the &lt;a href="https://www.thingiverse.com/thing:4536257">thingiverse&lt;/a> and &lt;a href="https://www.prusaprinters.org/prints/36325-8-port-keystone-patch-panel">prusaprinters&lt;/a> page.&lt;/p>
&lt;h2 id="printing">Printing:&lt;/h2>
&lt;p>Any material and at least 10% infill should be fine.
No supports if you use the suggested print orientation shown in picture below.
Tolerances on the jacks are somewhat tight so printing at a more accurate setting is probably going to be a good idea.&lt;/p>
&lt;h2 id="files">Files&lt;/h2>
&lt;p>For archive / posterity, all source files are included here. All files are licensed as &lt;a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike&lt;/a> (CC BY-NC-SA).&lt;/p>
&lt;ul>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/rear-installed.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/rear-installed_hua3383d84163f112bd060af4ed3b8937c_1343110_300x0_resize_q75_box.jpg" width="300" height="122">
&lt;/a>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/front-installed.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/front-installed_hu41ccff79e18526a44598cc32ce35c2c7_1597423_300x0_resize_q75_box.jpg" width="300" height="127">
&lt;/a>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/models/v1_keystone-bracket.3mf">
&lt;i class="far fa-file-archive">&lt;/i>
models/v1_keystone-bracket.3mf:
&lt;small style="font-family:'Lucida Console', monospace">3mf&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/models/v1_keystone-bracket.f3z">
&lt;i class="far fa-file-archive">&lt;/i>
models/v1_keystone-bracket.f3z:
&lt;small style="font-family:'Lucida Console', monospace">f3z&lt;/small> &lt;small>file&lt;/small>
&lt;br>
&lt;small>Fusion360 Archive&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/models/v1_keystone-bracket.stl">
&lt;i class="far fa-file-code">&lt;/i>
models/v1_keystone-bracket.stl:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/models/v2.3mf">
&lt;i class="far fa-file-archive">&lt;/i>
models/v2.3mf:
&lt;small style="font-family:'Lucida Console', monospace">3mf&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/models/v2.step">
&lt;i class="far fa-file-archive">&lt;/i>
models/v2.step:
&lt;small style="font-family:'Lucida Console', monospace">step&lt;/small> &lt;small>file&lt;/small>
&lt;br>
&lt;small>STEP file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/models/v2.stl">
&lt;i class="far fa-file-code">&lt;/i>
models/v2.stl:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/print_orientation.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/print_orientation_hu76c02f2da9eb89859f866c4853e1d8f8_295257_300x0_resize_q75_box.jpg" width="300" height="227">
&lt;/a>
&lt;figcaption>
&lt;small>Suggested print orientation&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/v2_installed_front.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/v2_installed_front_hueaa041fd3e89eb8857e8d8911e38c610_2003909_300x0_resize_q75_box.jpg" width="300" height="220">
&lt;/a>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/v2_installed_rear.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/07/home-lab-mini-universal-patch-panel/images/v2_installed_rear_huc45c71727a5e03d4cd0254c0178b7cc0_903650_300x0_resize_q75_box.jpg" width="300" height="265">
&lt;/a>
&lt;figcaption>
&lt;small>Yes, I do need to re-do the cable runs; they&amp;#39;re a mess&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;/ul></description></item><item><title>home lab: consolidating multiple PSUs</title><link>https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/</link><pubDate>Sat, 27 Jun 2020 00:00:00 +0000</pubDate><guid>https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/</guid><description>&lt;p>A while back, I traded writing salt states and managing systemd &lt;code>.service&lt;/code> files wrapping &lt;code>podman&lt;/code> for the &lt;a href="https://www.youtube.com/watch?v=9wvEwPLcLcA">&amp;lsquo;simplicity&amp;rsquo;&lt;/a> of running kubernetes in my home lab. Jury is still out on weather or not the switch was worth it.&lt;/p>
&lt;p>The cluster is a hodgepodge of second hand Intel NUCs and other scavenged compute hardware i&amp;rsquo;ve collected over the past few years. Some of it runs on 12v, some of it on 19v. For each node, there&amp;rsquo;s a dedicated switch mode power supply. Each supply takes up an outlet and brings a bit of cable mgmt related clutter. The solution is consolidation.&lt;/p>
&lt;p>So thats how this project came to be.&lt;/p>
&lt;h2 id="what">What&lt;/h2>
&lt;p>A set of 3d printable parts to compactly combine two LRS-350 PSUs into a compact unit with optional voltage and current displays.&lt;/p>
&lt;p>The details are on the &lt;a href="https://www.thingiverse.com/thing:4504948">thingiverse&lt;/a> and &lt;a href="https://www.prusaprinters.org/prints/35514-dual-mean-well-lrs-350-psu">prusaprinters&lt;/a> page.&lt;/p>
&lt;h2 id="files">Files&lt;/h2>
&lt;p>For archive / posterity, all source files are included here. All files are licensed as &lt;a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike&lt;/a> (CC BY-NC-SA).&lt;/p>
&lt;ul>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/built.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/built_hue8f36c4f699ca512381ec1ecdae0f96e_1394325_300x0_resize_q75_box.jpg" width="300" height="189">
&lt;/a>
&lt;figcaption>
&lt;small>Fully Assembled; ignore the messy workbench&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/cad-back.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/cad-back_hu9cc2ce5e929a14998f22cb542d786aa7_342135_300x0_resize_q75_box.jpg" width="300" height="215">
&lt;/a>
&lt;figcaption>
&lt;small>component view, from rear&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/cad-front.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/cad-front_hue2810dd6e158cf3715e15de998852c44_365005_300x0_resize_q75_box.jpg" width="300" height="220">
&lt;/a>
&lt;figcaption>
&lt;small>component view, from front&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/core.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/core_hue43f3402df27eedd99dff8c904086e8c_310336_300x0_resize_q75_box.jpg" width="300" height="219">
&lt;/a>
&lt;figcaption>
&lt;small>Print Bed arrangement, green is support structures&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/meter-panel.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/meter-panel_hu546d99e5993001046c71e4a3333af77d_135643_300x0_resize_q75_box.jpg" width="300" height="267">
&lt;/a>
&lt;figcaption>
&lt;small>meter panel print orientation&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/models/2x-lrs-psu.f3z">
&lt;i class="far fa-file-archive">&lt;/i>
Consolidated PSU CAD:
&lt;small style="font-family:'Lucida Console', monospace">f3z&lt;/small> &lt;small>file&lt;/small>
&lt;br>
&lt;small>Fusion360 Archive&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/models/box.stl">
&lt;i class="far fa-file-code">&lt;/i>
Box:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/models/brace.stl">
&lt;i class="far fa-file-code">&lt;/i>
Brace:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/models/core.3mf">
&lt;i class="far fa-file-archive">&lt;/i>
Core Components:
&lt;small style="font-family:'Lucida Console', monospace">3mf&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/models/lid.stl">
&lt;i class="far fa-file-code">&lt;/i>
Lid:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/models/meter-panel.3mf">
&lt;i class="far fa-file-archive">&lt;/i>
(Optional) Meter Panel:
&lt;small style="font-family:'Lucida Console', monospace">3mf&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/models/meter-panel.stl">
&lt;i class="far fa-file-code">&lt;/i>
(Optional) Meter Panel:
&lt;small style="font-family:'Lucida Console', monospace">stl&lt;/small> &lt;small>file&lt;/small>
&lt;/a>
&lt;/li>
&lt;li>
&lt;figure>
&lt;a target="_blank" href="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/meter-panel-slice.jpg">
&lt;img style="width: auto; height: auto;" src="https://karlquinsland.com/2020/06/home-lab-consolidating-multiple-psus/images/meter-panel-slice_hu512c49ce3497e3dea530288ed57cb214_547680_300x0_resize_q75_box.jpg" width="300" height="255">
&lt;/a>
&lt;figcaption>
&lt;small>using slic3r too remove the second meter cutout&lt;/small>
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;/ul></description></item></channel></rss>
<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Adding an airborne particulate mater sensor to WS3 Weather Station - karl</title><meta name=Description content="An update to ESPHome custom_component to capture particulate matter sensor values from WS3 Weather Station"><meta property="og:url" content="https://karlquinsland.com/ws3-weather-station-pm25-sensor/"><meta property="og:site_name" content="karl"><meta property="og:title" content="Adding an airborne particulate mater sensor to WS3 Weather Station"><meta property="og:description" content="An update to ESPHome custom_component to capture particulate matter sensor values from WS3 Weather Station"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-27T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-27T00:00:00+00:00"><meta property="article:tag" content="Fusion-360"><meta property="article:tag" content="Has:download"><meta property="article:tag" content="Esphome"><meta property="article:tag" content="Home-Assistant"><meta property="og:image" content="https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/04.installed.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/04.installed.webp"><meta name=twitter:title content="Adding an airborne particulate mater sensor to WS3 Weather Station"><meta name=twitter:description content="An update to ESPHome custom_component to capture particulate matter sensor values from WS3 Weather Station"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/><link rel=prev href=https://karlquinsland.com/rss-and-homeassistant-for-early-blackout-warning/><link rel=next href=https://karlquinsland.com/enhanced-homeassistantswitchplate/><link rel=stylesheet href=/css/style.min.658eb25b73ad29ab864a36ed014516c5047802d1ff98d0080132d1abe1332f5b.css integrity="sha256-ZY6yW3OtKauGSjbtAUUWxQR4AtH/mNAIATLRq+EzL1s="><link rel=preload href=/lib/fontawesome-free/all.min.0df5a33710e433de1f5415b1d47e4130ca7466aee5b81955f1045c4844bbb3ed.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.0df5a33710e433de1f5415b1d47e4130ca7466aee5b81955f1045c4844bbb3ed.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0="></noscript><link rel=preload href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Adding an airborne particulate mater sensor to WS3 Weather Station","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/karlquinsland.com\/ws3-weather-station-pm25-sensor\/"},"genre":"posts","keywords":"fusion-360, has:download, esphome, home assistant","wordcount":1659,"url":"https:\/\/karlquinsland.com\/ws3-weather-station-pm25-sensor\/","datePublished":"2020-08-27T00:00:00+00:00","dateModified":"2020-08-27T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"karl"},"description":"An update to ESPHome custom_component to capture particulate matter sensor values from WS3 Weather Station"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=karl>Karl</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/><i class="fas fa-blog"></i> Posts </a><a class=menu-item href=/resume/ title="Hire Me!"><i class="fas fa-briefcase"></i> RÃ©sumÃ© </a><a class=menu-item href=/tags/ title="Can you tell that I don't have a super consistent or clear taxonomy?"><i class="fas fa-tags"></i> Tags </a><a class=menu-item href=/contact/><i class="fas fa-address-book"></i> Contact </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=karl>Karl</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title><i class="fas fa-blog"></i>Posts</a><a class=menu-item href=/resume/ title="Hire Me!"><i class="fas fa-briefcase"></i>RÃ©sumÃ©</a><a class=menu-item href=/tags/ title="Can you tell that I don't have a super consistent or clear taxonomy?"><i class="fas fa-tags"></i>Tags</a><a class=menu-item href=/contact/ title><i class="fas fa-address-book"></i>Contact</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Adding an airborne particulate mater sensor to WS3 Weather Station</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>karl</a></span>&nbsp;<span class=post-category>included in <a href=/categories/observability/><i class="far fa-folder fa-fw" aria-hidden=true></i>Observability</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-08-27>2020-08-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1659 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;8 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#the-enclosure>The enclosure</a><ul><li><a href=#printing>Printing</a></li></ul></li><li><a href=#assemble>Assemble</a><ul><li><a href=#bill-of-materials>Bill of Materials</a></li><li><a href=#wiring>Wiring</a></li></ul></li><li><a href=#the-code>The code</a></li><li><a href=#files>Files</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>A while back, I <a href=https://github.com/kquinsland/ws3-to-esphome-bridge/ target=_blank rel="noopener noreffer">posted a small bit of code</a> that could decode the data from the ubiquitous WS3 Weather Station and make it accessible to the amazing <a href=https://www.home-assistant.io/ target=_blank rel="noopener noreffer">HomeAssistant</a> via the wonderful <a href=https://esphome.io/ target=_blank rel="noopener noreffer">ESPHome</a> project. Since then, my weather station has been dutifully collecting data that&rsquo;s been invaluable for augmenting automation that deals with indoor climate.</p><p>As the numerous wild fires in California rage on, <a href=https://www.forbes.com/sites/ericmack/2020/08/21/wildfire-smoke-blankets-the-west-as-california-records-worlds-worst-air-quality/ target=_blank rel="noopener noreffer">the air quality has gone from bad to dangerous</a>. Knowing that outside was warmer, but less humid, was no longer enough to make a smart decision about weather or not to open the windows for some cost-effective cooling. I now need HomeAssistant to be aware of how clean the outside air was before making the decision to pipe in outdoor air.</p><p>This post covers two things:</p><ul><li>A small update to the existing WS3 -> ESPHome -> HomeAssistant bridge code to take advantage of the WS3s&rsquo; support for the ubiquitous <code>PMS5003T</code> sensor.</li><li>A simple 3d-printable enclosure for deploying the particulate matter sensor outdoors</li></ul><p>When deployed, it looks like this:</p><figure><img src=/ws3-weather-station-pm25-sensor/images/04.installed.webp alt="Picture showing designed parts assembled and deployed as intended"><figcaption><p>Excuse the awkward camera angle; sensor is deployed in an awkward to photograph location.</p></figcaption></figure><p>Please ignore the awkward camera angle as the sensor is deployed in a location where there&rsquo;s not quite enough room for proper camera placement.</p><p>And results in graphs that look like this:</p><figure><img src=/ws3-weather-station-pm25-sensor/images/example_dashboard.webp alt="Picture showing a simple WS3 dashboard in Grafana"><figcaption><p>Smoke particles are between .4Î¼m to .7Î¼m in size... which explains the elevated red line relative to other particle sizes.</p></figcaption></figure><p>A simplified copy of this post appears on <a href=https://www.thingiverse.com/thing:4581351 target=_blank rel="noopener noreffer">thingiverse</a> and <a href=https://www.prusaprinters.org/prints/39560-outdoor-enclosure-for-pms5003-particulate-matter-s target=_blank rel="noopener noreffer">prusaprinters</a>.</p><h2 id=the-enclosure>The enclosure</h2><p>As of writing, there&rsquo;s <a href=https://www.thingiverse.com/thing:4044492 target=_blank rel="noopener noreffer">one existing enclosure</a> for the sensor on thingiverse. Unfortunately, the enclosure does not appear to have any design features for mounting to a pole nor does it have any bug-proofing design elements. I took this opportunity to design my own that could be easily mounted, features a slanted &lsquo;roof&rsquo; to prevent standing moisture ingress and could use standard size tobacco pipe filters to keep all but the tiniest of insects/particles out.</p><p>The sensor uses a small fan to draw ambient air past an infrared laser. As airborne particles cross the laser beam, they reflect a certain amount of light which can be correlated with the size of the particle. This data can then be turned into fairly accurate counts of how many particles of a given size are in the sampled air. The enclosure is a basic box with two circular air channels pointed downwards to prevent moisture ingress. The intake and exhaust ports are at staggered heights and pointed in opposite directions and to minimize the chance of recirculating the same air.</p><p>The lower port is the intake which connects to a few small holes on the front of the sensor and the exhaust port is the raised port which connects directly to the exhaust fan. If you could remove the first few mm from the front, it would look something like this:</p><figure><img src=/ws3-weather-station-pm25-sensor/images/f360_air_channels.webp alt="Screenshot showing labeled ingress/egress for air flow"><figcaption></figcaption></figure><p>From the side, you can see the two air channels and the few mm of room in the back for wiring. The sensor sits on a &lsquo;pedestal&rsquo; to keep it elevated away from any moisture that may collect on the bottom of the enclosure.</p><p>The base plate/pedestal are secured to the &lsquo;body&rsquo; with two M3 screws. I used <code>10mm</code> as that&rsquo;s what I had on hand, but screws between 6-12mm should work as well. The holes are sized for a M3, but any similar sized screw will work. Use a lighter or similar to heat the screw as you drive it into the plastic to create your own threads if using a larger/longer screw.</p><p>Besides the &lsquo;pedestal&rsquo; there are a few contact surfaces that hold on to the sensor with a friction fit. The &lsquo;ceiling&rsquo; is a few mm thick and shouldn&rsquo;t permit much moisture ingress but an optional slanted roof component can be printed as an extra precaution.</p><figure><img src=/ws3-weather-station-pm25-sensor/images/f360_side_profile.webp alt="Screenshot showing side profile of assembly and the two ports"><figcaption><p>Upper and lower chambers for exhaust and intake.</p></figcaption></figure><p>While designing the enclosure, I used this <a href=https://grabcad.com/library/pms5003-2 target=_blank rel="noopener noreffer"><code>PMS5003</code> model</a> from Leclercq Gregory. :pray:</p><h3 id=printing>Printing</h3><p>This is a functional part with only three small surfaces that require reasonably tight precision to properly hold onto the sensor. The <code>SPEED</code> setting with a <code>.2mm</code> layer height and a reasonable 20% infill gave me part that works and feels water tight. The walls and ceiling need to keep water out so dipping below 15% infill or otherwise using settings that wont give solid layer adhesion is not advised. I printed using ABS for durability, but PLA will probably work if you can deploy into a shaded environment.</p><p>The shroud and the base are not optional, the triangle shaped block is intended to turn the flat roof of the shroud into a slanted roof so water can&rsquo;t collect. It is optional but shown below.</p><figure><img src=/ws3-weather-station-pm25-sensor/images/suggested_print_orientation.webp alt="Screenshot showing suggested print bed arrangement"><figcaption><p>No raft/support when printed in this orientation.</p></figcaption></figure><h2 id=assemble>Assemble</h2><p>Briefly:</p><ul><li>collect materials</li><li>press-fit the PM2.5 sensor into the enclosure</li><li>make a wire that can interface the PM2.5 sensor to the WS3 board via RJ11</li><li>seal everything up</li><li>glue on mesh screens and angled roof</li><li>plug into WS3</li><li>flash ESPHome onto</li></ul><h3 id=bill-of-materials>Bill of Materials</h3><p>More or less everything that is needed for assembly is pictured below.</p><figure><img src=/ws3-weather-station-pm25-sensor/images/01.collect.webp alt="Picture showing tools/materials required for assembly"><figcaption><p>More or less everything needed to assemble.</p></figcaption></figure><p>Components:</p><ul><li><p><a href=https://www.aliexpress.com/item/32921725022.html target=_blank rel="noopener noreffer">WS3 Weather Station</a> - Essential / Foundational</p></li><li><p><a href="https://rover.ebay.com/rover/1/711-53200-19255-0/1?mpre=https%3A%2F%2Fwww.ebay.com%2Fitm%2FDigital-Universal-Particle-Concentration-Laser-Sensor-PMS5003-PM1-0-PM2-5-PM10%2F254616699639&amp;campid=5338734064&amp;toolid=10001&amp;customid=" target=_blank rel="noopener noreffer">ST5003T PM2.5 Sensor</a> - Essential / Foundational</p></li><li><p><a href="https://rover.ebay.com/rover/1/711-53200-19255-0/1?mpre=https%3A%2F%2Fwww.ebay.com%2Fitm%2FTTGO-Wemos-MINI-D1-ESP32-WiFi-Bluetooth-Wemos-D1-Mini-ESP8266-ESP-32-Module%2F183413480551&amp;campid=5338734064&amp;toolid=10001&amp;customid=" target=_blank rel="noopener noreffer">ESP32 Device</a> - A link to the ESP32 based device that I use but any ESP platform with a spare GPIO that can be used as a UART will work.</p></li><li><p><a href="https://rover.ebay.com/rover/1/711-53200-19255-0/1?mpre=https%3A%2F%2Fwww.ebay.com%2Fitm%2F25-Stainless-Steel-Smoking-Pipe-Screens-3-4-19mm-Tobacco-HOOKAH-FILTER-Heavy%2F183969079809&amp;campid=5338734064&amp;toolid=10001&amp;customid=" target=_blank rel="noopener noreffer">3/4 inch tobacco pipe screens</a> - For bug/critter proofing the enclosure. Strongly suggested for outdoor deployments.</p></li><li><p><a href=https://www.mcmaster.com/91292A113/ target=_blank rel="noopener noreffer">2x M3 x 10mm screws</a> - Optional. The base can be glued to the shroud or any similar screw will work</p></li></ul><p><strong>Note</strong>: Where possible, I&rsquo;ve used referral links. The links don&rsquo;t raise the price of any item, they simply let the retailer know that I sent you and, in return, I get a small cut of your purchase. If you&rsquo;re not comfortable with that, you can use a URL unwinding service to get the &lsquo;raw&rsquo; product link and drop the attribution/commission part.</p><p>General bits:</p><ul><li>Superglue</li><li>Waterproofing caulk/sealant</li><li>Drill/Screwdriver</li><li>Driver bit for the screws</li></ul><p>The stepped drill bit in the above picture is not a requirement if you assemble things in the correct oder. The cable egress hole is sized for a &rsquo;typical&rsquo; 3 pair <a href=https://en.wikipedia.org/wiki/Registered_jack#RJ11,_RJ14,_RJ25_wiring target=_blank rel="noopener noreffer">RJ11 cable</a> plus a tiny bit of wiggle room. I needed a working cable to test the code while the parts were printing so the hole in the printed base needed to be enlarged slightly to fit the head of the cable.</p><h3 id=wiring>Wiring</h3><p>There&rsquo;s no ready-made cable out there that&rsquo;ll join the two devices so one must be made. Fortunately, there&rsquo;s only 6 wires to deal with&mldr; 4 of them are distinct.</p><p>Sacrifice the cable that comes with the PM2.5 sensor and the RJ11 cable by cutting them in half and solder the correct wires together. The <em>color</em> of the wires that come in both the RJ11 cable and the PM2.5 cable are likely going to differ from the ones I used so I&rsquo;ve left those details out and provided a table showing which pins are to be joined together:</p><table><thead><tr><th>Pin #</th><th>PM2.5 Sensor Pin</th><th>WS3 Pin</th></tr></thead><tbody><tr><td>1</td><td>VCC</td><td>5V</td></tr><tr><td>2</td><td>GND</td><td>GND</td></tr><tr><td>3</td><td>SET</td><td>ENABLE</td></tr><tr><td>4</td><td>RX</td><td>RX</td></tr><tr><td>5</td><td>TX</td><td>GND</td></tr><tr><td>6</td><td>RESET</td><td>5V</td></tr><tr><td>7</td><td>NC</td><td></td></tr><tr><td>8</td><td>NC</td><td></td></tr></tbody></table><p>For reference, Pin 1 on both the WS3 and PM2.5 Sensor:</p><figure><img src=/ws3-weather-station-pm25-sensor/images/pin_out/WS3_Pins.webp alt="Screenshot showing the RJ11 jack on WS3 board w/ pin numbers"><figcaption></figcaption></figure><figure><img src=/ws3-weather-station-pm25-sensor/images/pin_out/PM2.5_Pins.webp alt="Screenshot showing labeled pins on the 8 pin jack on the back of the PM2.5 sensor"><figcaption></figcaption></figure><p>With the wiring done, the sensor just needs to be stuffed into the enclosure. Don&rsquo;t forget to thread the RJ11 cable through the hole in the base plate <em>BEFORE</em> soldering it to the cable for the PM2.5 sensor&mldr; otherwise you&rsquo;ll need that stepped drill bit! ðŸ™ƒ</p><figure><img src=/ws3-weather-station-pm25-sensor/images/02.assemble.webp alt="Picture showing sensor inserted into printed shroud"><figcaption><p>Sensor has been press-fit into the enclosure and wire fed through the base plate.</p></figcaption></figure><p>To finish, secure the base with screws and a bit of water-proofing caulk for good measure:</p><figure><img src=/ws3-weather-station-pm25-sensor/images/03.glue.webp alt="Picture showing assembled components while glue/caulk curing"><figcaption><p>I suggest waiting until the end to glue on the optional roof and waiting until just before that to glue on the optional mesh screens.</p></figcaption></figure><h2 id=the-code>The code</h2><p>Setting up and using ESPHome is outside the scope of this post but there are several <a href=https://esphome.io/guides/getting_started_hassio.html target=_blank rel="noopener noreffer">good guides</a> out there. Once you have that set up, <a href=https://esphome.io/custom/custom_component.html target=_blank rel="noopener noreffer">include</a> the <code>ws3.h</code> file and set up your custom sensor as shown below. A working example and more detail is over on the
<a href=https://github.com/kquinsland/ws3-to-esphome-bridge/ target=_blank rel="noopener noreffer">github repo</a>.</p><p>It&rsquo;ll look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>uart</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>uart_bus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># At this time, ESP does not Transmit anything to the WS3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tx_pin</span><span class=p>:</span><span class=w> </span><span class=l>GPIO16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rx_pin</span><span class=p>:</span><span class=w> </span><span class=l>GPIO17</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>baud_rate</span><span class=p>:</span><span class=w> </span><span class=m>2400</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>sensor</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lambda</span><span class=p>:</span><span class=w> </span><span class=p>|-</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      auto ws3 = new WS3(id(uart_bus));
</span></span></span><span class=line><span class=cl><span class=sd>      App.register_component(ws3);
</span></span></span><span class=line><span class=cl><span class=sd>      return {
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;temperature_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;pressure_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;humidity_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;wind_speed_current_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;wind_speed_peak_5m_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;wind_direction_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;rain_fall_1h_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;rain_fall_24h_sensor,
</span></span></span><span class=line><span class=cl><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;particles_03um,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;particles_05um,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;particles_10um,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;particles_25um,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;particles_50um,
</span></span></span><span class=line><span class=cl><span class=sd>        ws3-&gt;particles_100um,
</span></span></span><span class=line><span class=cl><span class=sd>      };</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>With that, check the logs from your instance of ESPHome and you should see something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[D][ws3:157]: pkt_read_ok!
</span></span><span class=line><span class=cl>[D][WS3:410]: VALID! Packet: [c000s000g000t093r000p000h35b09880,050,080,088,502,056,065,*18
</span></span><span class=line><span class=cl>], Checksum: [18] chksum: [18]
</span></span><span class=line><span class=cl>[E][WS3:342]: Validating: [c000s000g000t093r000p000h35b09880,050,080,088,502,056,065]
</span></span></code></pre></td></tr></table></div></div><p>indicating that the WS3 has detected the PM2.5 sensor and is reporting it&rsquo;s readings in addition to the temperature/wind data. Then just check your HomeAssistant install for the data.</p><h2 id=files>Files</h2><p>For archive / posterity, all source files are included here. All files are licensed as <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="noopener noreffer">Creative Commons Attribution-NonCommercial-ShareAlike</a> (CC BY-NC-SA).</p><ul><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/02.assemble.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/02.assemble_hu_1b230475975fe7fa.webp width=300 height=414></a><figcaption><small>Sensor has been press-fit into the enclosure and wire fed through the base plate.</small></figcaption></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/03.glue.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/03.glue_hu_c9d215655a217bf1.webp width=300 height=398></a><figcaption><small>I suggest waiting until the end to glue on the optional roof and waiting until just before that to glue on the optional mesh screens.</small></figcaption></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/example_dashboard.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/example_dashboard_hu_6cb84865e6d7cc20.webp width=300 height=163></a><figcaption><small>Smoke particles are between .4Î¼m to .7Î¼m in size... which explains the elevated red line relative to other particle sizes.</small></figcaption></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/04.installed.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/04.installed_hu_51b7136f490ed4c5.webp width=300 height=309></a><figcaption><small>Excuse the awkward camera angle; sensor is deployed in an awkward to photograph location.</small></figcaption></figure></li><li><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/models/BASE.step><i class="far fa-file-code"></i>
models/BASE.step:
<small style="font-family:lucida console,monospace">step</small> <small>file</small></a></li><li><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/models/BODY.step><i class="far fa-file-code"></i>
models/BODY.step:
<small style="font-family:lucida console,monospace">step</small> <small>file</small></a></li><li><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/models/LID.step><i class="far fa-file-code"></i>
models/LID.step:
<small style="font-family:lucida console,monospace">step</small> <small>file</small></a></li><li><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/models/base.stl><i class="far fa-file-code"></i>
models/base.stl:
<small style="font-family:lucida console,monospace">stl</small> <small>file</small></a></li><li><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/models/body.stl><i class="far fa-file-code"></i>
models/body.stl:
<small style="font-family:lucida console,monospace">stl</small> <small>file</small></a></li><li><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/models/combined.3mf><i class="far fa-file-archive"></i>
models/combined.3mf:
<small style="font-family:lucida console,monospace">3mf</small> <small>file</small></a></li><li><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/models/lid.stl><i class="far fa-file-code"></i>
models/lid.stl:
<small style="font-family:lucida console,monospace">stl</small> <small>file</small></a></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/pin_out/PM2.5_Pins.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/pin_out/PM2.5_Pins_hu_a00db96da1c0e2f9.webp width=300 height=152></a></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/pin_out/WS3_Pins.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/pin_out/WS3_Pins_hu_b2548bd6aa0c821e.webp width=300 height=214></a></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/01.collect.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/01.collect_hu_2f2f250756baa9da.webp width=300 height=338></a><figcaption><small>More or less everything needed to assemble.</small></figcaption></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/suggested_print_orientation.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/suggested_print_orientation_hu_9fa666e1d4fd8d2f.webp width=300 height=175></a><figcaption><small>No raft/support when printed in this orientation.</small></figcaption></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/f360_air_channels.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/f360_air_channels_hu_77aebb631e80ca5b.webp width=300 height=436></a></figure></li><li><figure><a target=_blank href=https://karlquinsland.com/ws3-weather-station-pm25-sensor/images/f360_side_profile.webp><img style=width:auto;height:auto src=/ws3-weather-station-pm25-sensor/images/f360_side_profile_hu_f7db24016d8c7793.webp width=300 height=324></a><figcaption><small>Upper and lower chambers for exhaust and intake.</small></figcaption></figure></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-08-27</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/ws3-weather-station-pm25-sensor/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/fusion-360/>Fusion-360</a>,&nbsp;<a href></a>,&nbsp;<a href=/tags/esphome/>Esphome</a>,&nbsp;<a href=/tags/home-assistant/>Home-Assistant</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/rss-and-homeassistant-for-early-blackout-warning/ class=prev rel=prev title="RSS and Home Assistant: early warning for grid blackouts"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>RSS and Home Assistant: early warning for grid blackouts</a>
<a href=/enhanced-homeassistantswitchplate/ class=next rel=next title="Enhanced Home Assistant Switch Plate (HASP)">Enhanced Home Assistant Switch Plate (HASP)<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Â¯\_(ãƒ„)_/Â¯</div><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.152.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>karl</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.76e39bd605d45b2d1944123c66608b0c8bb9baeb70720b212571531c7cf9bc2a.css integrity="sha256-duOb1gXUWy0ZRBI8ZmCLDIu5uutwcgshJXFTHHz5vCo="><script type=text/javascript src=/lib/autocomplete/autocomplete.min.ae2da1bd62c6469ee27770ad1cddf2e8296d8a7f6d85b091463e5200c5e320af.js integrity="sha256-ri2hvWLGRp7id3CtHN3y6Cltin9thbCRRj5SAMXjIK8="></script><script type=text/javascript src=/lib/lunr/lunr.min.08a93c0120364b01159db3c287f39b2180bb740334472bda0675bd3f18981676.js integrity="sha256-CKk8ASA2SwEVnbPCh/ObIYC7dAM0RyvaBnW9PxiYFnY="></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.3d9120fa621da6d613c1698b7014ec6bdf4620366e8f2b7b547059f4b6f6272b.js integrity="sha256-PZEg+mIdptYTwWmLcBTsa99GIDZujyt7VHBZ9Lb2Jys="></script><script type=text/javascript src=/lib/clipboard/clipboard.min.e17a1d816e13c0826e0ed7febfabc3277f45571234bde0bf9120829a7169edc9.js integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck="></script><script type=text/javascript src=/lib/katex/katex.min.eb18207487161674e717087c317db14ac1a62dadaecccb802499ce173bfeb739.js integrity="sha256-6xggdIcWFnTnFwh8MX2xSsGmLa2uzMuAJJnOFzv+tzk="></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.cb7f4ca60ed5dc3e258415f8c7a3b46d4a93578a52adf83011f18a7f190e7602.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.52ce78fab4860d24ef22128a52ce24ca01368a9034457a565a1d3fccbab0ddbb.js integrity="sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.5c0a121a8b490afc85860a522347aeb34fb508c6b23044e5d29f6b2194227b51.js integrity="sha256-XAoSGotJCvyFhgpSI0eus0+1CMayMETl0p9rIZQie1E="></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.612a51a43205bbcf3b4af348dc2e8aa60f77f4fe5535ebc57f13054b61607d6c.js integrity="sha256-YSpRpDIFu887SvNI3C6Kpg939P5VNevFfxMFS2FgfWw="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3WZ55XG701",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-3WZ55XG701" async></script></body></html>
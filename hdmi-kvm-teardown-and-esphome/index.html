<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Inside a generic/white-label HDMI KVM Switch - karl</title><meta name=Description content="Still searching for the perfect KVM but in the mean time here's an ESPHome integration."><meta property="og:url" content="https://karlquinsland.com/hdmi-kvm-teardown-and-esphome/"><meta property="og:site_name" content="karl"><meta property="og:title" content="Inside a generic/white-label HDMI KVM Switch"><meta property="og:description" content="Still searching for the perfect KVM but in the mean time here's an ESPHome integration."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-16T00:00:00+00:00"><meta property="article:tag" content="Esphome"><meta property="article:tag" content="Home-Assistant"><meta property="og:image" content="https://karlquinsland.com/hdmi-kvm-teardown-and-esphome/images/teardown.first-full-view.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://karlquinsland.com/hdmi-kvm-teardown-and-esphome/images/teardown.first-full-view.webp"><meta name=twitter:title content="Inside a generic/white-label HDMI KVM Switch"><meta name=twitter:description content="Still searching for the perfect KVM but in the mean time here's an ESPHome integration."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://karlquinsland.com/hdmi-kvm-teardown-and-esphome/><link rel=prev href=https://karlquinsland.com/xaomi-s1-monitor-lamp-teardown-and-tasmota/><link rel=next href=https://karlquinsland.com/venstar-t7850-teardown-review/><link rel=stylesheet href=/css/style.min.658eb25b73ad29ab864a36ed014516c5047802d1ff98d0080132d1abe1332f5b.css integrity="sha256-ZY6yW3OtKauGSjbtAUUWxQR4AtH/mNAIATLRq+EzL1s="><link rel=preload href=/lib/fontawesome-free/all.min.0df5a33710e433de1f5415b1d47e4130ca7466aee5b81955f1045c4844bbb3ed.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.0df5a33710e433de1f5415b1d47e4130ca7466aee5b81955f1045c4844bbb3ed.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0="></noscript><link rel=preload href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Inside a generic/white-label HDMI KVM Switch","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/karlquinsland.com\/hdmi-kvm-teardown-and-esphome\/"},"genre":"posts","keywords":"esphome, home assistant","wordcount":2487,"url":"https:\/\/karlquinsland.com\/hdmi-kvm-teardown-and-esphome\/","datePublished":"2022-04-16T00:00:00+00:00","dateModified":"2022-04-16T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"karl"},"description":"Still searching for the perfect KVM but in the mean time here's an ESPHome integration."}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=karl>Karl</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/><i class="fas fa-blog"></i> Posts </a><a class=menu-item href=/resume/ title="Hire Me!"><i class="fas fa-briefcase"></i> RÃ©sumÃ© </a><a class=menu-item href=/tags/ title="Can you tell that I don't have a super consistent or clear taxonomy?"><i class="fas fa-tags"></i> Tags </a><a class=menu-item href=/contact/><i class="fas fa-address-book"></i> Contact </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=karl>Karl</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title><i class="fas fa-blog"></i>Posts</a><a class=menu-item href=/resume/ title="Hire Me!"><i class="fas fa-briefcase"></i>RÃ©sumÃ©</a><a class=menu-item href=/tags/ title="Can you tell that I don't have a super consistent or clear taxonomy?"><i class="fas fa-tags"></i>Tags</a><a class=menu-item href=/contact/ title><i class="fas fa-address-book"></i>Contact</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Inside a generic/white-label HDMI KVM Switch</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>karl</a></span>&nbsp;<span class=post-category>included in <a href=/categories/teardown/><i class="far fa-folder fa-fw" aria-hidden=true></i>Teardown</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-04-16>2022-04-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2487 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;12 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#teardown>Teardown</a><ul><li><a href=#packaging--shipping>Packaging / shipping</a></li><li><a href=#the-switch>The switch</a><ul><li><a href=#front-pcb>Front PCB</a></li><li><a href=#the-lan-module>The LAN module</a></li></ul></li><li><a href=#hdmi>HDMI</a></li><li><a href=#usb>USB</a><ul><li><a href=#dmesg><code>dmesg</code></a></li></ul></li><li><a href=#esphome-component>ESPHome component</a></li><li><a href=#ics-and-distinguishing-markings>ICs and distinguishing markings</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>If you&rsquo;re here just for &ldquo;how do I get it working with ESPHome&rdquo; bit, skip to the <a href=#esphome-component rel>ESPHome Component</a> section below.</p><hr><div class="details admonition important open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Update 2022.05.14<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>I have just uploaded a basic PCB and enclosure to the <a href=#esphome-component rel>ESPHome Component Repository</a>.</div></div></div><p>For the last few months, I have been looking for a KVM switch to simplify switching between work and personal computers.
Initially, I didn&rsquo;t think my criteria were that unreasonable, but for whatever reason there is no KVM switch that:</p><ul><li>Supports at least 4 hosts. Preferably dual monitors per host to ensure relevancy for years. Converting between HDMI and Display Port isn&rsquo;t that difficult so no strong preference as long as the KVM uses HDMI2.0+ or Display Port 1.4+ as my primary monitor is 4k.</li><li>USB 3 support. At least 5 gbps and Ideally using a USBC jack.</li><li>Some sort of programmatic control over which host is &lsquo;active&rsquo;. Ideally this interface would be bi-directional (RS232/RS485 or IP) but I&rsquo;d settle for having to record the IR remote codes and re-broadcast those with my own microcontroller if needed.</li><li>Works with the <a href=https://drop.com/buy/drop-shift-mechanical-keyboard target=_blank rel="noopener noreffer">DROP: SHIFT keyboard</a>; internally this keyboard presents as it&rsquo;s own USB Hub and requires more than the standard 500ma to operate. Some KVM switches don&rsquo;t supply enough current and others results in the number of USB hubs between the root and the keyboard being > 5 which the USB spec does not support.</li><li>Costs less than $75 per host/port.</li></ul><p>Try as I might, I was not able to find anything that could satisfy all the requirements. If you know of any, <a href=https://karlquinsland.com/contact/ rel>please do get in touch</a>!</p><p>I spent a decent chunk of time searching through the usual consumer/IT electronics sites and they all had similar offerings&mldr; none of which were sufficient.
I had some close contenders, but they are victims of the current chip shortage or otherwise very expensive unobtanium.</p><p>I recently read <a href=https://overengineer.dev/blog/2021/04/25/usb-c-hub-madness.html target=_blank rel="noopener noreffer">USB-C hubs and my slow descent into madness - Dennis Schubert</a> which prompted me to broaden my search horizons to include the marketplaces closer to where all the KVM switches I was seeing in my searches were actually designed.
After a bit of searching, I found the <a href=https://www.aliexpress.com/item/1005003927404402.html target=_blank rel="noopener noreffer"><code>PX-UHDKVM801-2.0</code></a>:</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/ali_exp_listing.webp><figcaption></figcaption></figure><p>A single video channel isn&rsquo;t a deal breaker; ultra wide screens can render more pixels off of one HDMI port than 2 screens from a few years ago could. Assuming this continues, by the time my current monitor dies dual video might not matter at all.
Likewise, speedy USB is a &ldquo;nice to have&rdquo;. My keyboard, mouse and web cam <strong>must</strong> work with the KVM. If the webcam streams in SD over USB2 but full HD over a USB3 link that&rsquo;s a <em>nice</em> benefit but not a deal breaker. For the occasional times where I need to transfer a file and can&rsquo;t do it over the network, I can either plug directly into the host computers&rsquo; USB3.2 port or settle for slow USB2 file transfer speeds. Not the end of the world!</p><p>Of all the KVMs that I considered, this one came with the least compromises and came with explicit documentation about how to integrate/control the switch via TCP or RS232. Buoyed by the thought of not having to reverse engineer any IR remote codes or otherwise resort to some hackery, I pulled the trigger.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>A quick note about the 'generic' switch<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>I say &ldquo;generic&rdquo; because there are a few different brands / names on this thing and it&rsquo;s not clear who the actual manufacturer is.</p><p>I got it from a seller by the name of <a href=https://www.pourxuan.com/Product/9867345045.html target=_blank rel="noopener noreffer"><code>PourXuan</code></a> which does seem to be the OEM behind it.
However, there are a few other <a href=#ics-and-distinguishing-markings rel>interesting markings</a> that could indicate other companies contributing to / designing some internal components.</p></div></div></div><p>Anyways, lets look inside.</p><h1 id=teardown>Teardown</h1><p>TL;DR: It&rsquo;s been built down to a cost&mldr; but not <em>the lowest possible cost</em>.
The construction isn&rsquo;t flimsy and I didn&rsquo;t find any glaringly obvious safety issues / construction shortcuts.
None of the ICs have their markings scraped off and the internal architecture is simple and scalable.
I did not check, but I suspect that each of the primary functions / PCBs communicates over a simple serial bus so this switch is likely pretty hackable/serviceable, too.</p><h2 id=packaging--shipping>Packaging / shipping</h2><p>The switch came well packed in some nondescript packaging.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/shipping-box.webp alt="Picture showing a nondescript shipping box."><figcaption></figcaption></figure><p>The small white box containing the power supply and some accessory hardware crumpled up the single page user manual.</p><p>I have uploaded a copy of this paper and the other software/documentation provided by the seller to the same git repository hosting the <a href=#esphome-component rel>ESPHome Component</a>.</p><p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/shipping-box-internal.webp alt="Picture showing the internal content of the shipping box. The KVM switch is secured with some foam."><figcaption></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/shipping-content.webp alt="An overview of everything that came in the box"><figcaption><p>An overview of everything that came in the box</p></figcaption></figure></p><p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/content-accessories.webp><figcaption></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/content-accessories-3.webp alt="Rack Mount ears, two extra screws and the proper connector block needed to interface with the UART."><figcaption><p>Rack Mount ears, two extra screws and the proper connector block needed to interface with the UART.</p></figcaption></figure></p><p>I have not opened up the power supply to check its construction but it doesn&rsquo;t feel incredibly cheap.
It&rsquo;s rated for 2 Amps @ 12v but the switch only drew about 3.75 Watt when measured from the wall.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/content-accessory-psu.webp alt="Nothing special. It doesn't feel cheap."><figcaption><p>Nothing special. It doesn't feel cheap.</p></figcaption></figure><h2 id=the-switch>The switch</h2><p>The metal shell is generic; there are holes on the side for ventilation fans that are not populated.
Other than not-so-well hidden screw, the case is easy to open.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/open-screw-sticker.webp alt="Don't forget the screw behind the sticker"><figcaption><p>Don't forget the screw behind the sticker</p></figcaption></figure><p>With all screws out, the two halves slide apart easily to give us the first look at the internals!</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/open-crack-case.webp><figcaption></figcaption></figure><p>It looks like this is a pretty modular design:</p><ul><li>A standalone front panel input and network control.</li><li>A dedicated PCB for each type of data; a HDMI/video plane and a HID/USB plane.</li><li>Each plane uses dedicated ASICs to route the signals.</li><li>A minimal number of microprocessors / wires coordinating between the PCBs.</li></ul><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.first-full-view.webp alt="The small cable from the IR jack on the back is all that holds the two halves of the case together."><figcaption><p>The small cable from the IR jack on the back is all that holds the two halves of the case together.</p></figcaption></figure><p>The LAN module plugs into the HDMI PCB very close to where the RS232 port is and the protocol specific documentation from the seller indicates that the payloads to control the switch are the same irrespective of the transport.</p><p>Each group of 4 HDMI &lsquo;inputs&rsquo; is routed to an identical looking IC and the differential signal pairs from <em>those</em> ICs are routed to the big one next to the output and RS232 and LAN circuitry.</p><p>The little micro next to the buzzer and grey ribbon cable is likely the main controller for the entire switch.
The small IC <em>on</em> the front panel is probably watching for IR signals, scanning the physical buttons, driving the LED display and communicating with the rest of the system over some serial bus.</p><p>This architecture would be pretty scalable; for a 16 port model, just add another HDMI and USB PCB and tweak the firmware on the main controller.</p><h3 id=front-pcb>Front PCB</h3><p>Nothing particularly interesting here. The single IC (<code>STM8S003F3</code>) is a cheap 8 bit microcontroller that - based on the PCB traces - is driving the LED display and handling the button matrix scanning and IR codes.</p><p>Most of the lines from the grey ribbon cable are not actually connected to the pcb so I&rsquo;d bet that this micro communicates with the &lsquo;main&rsquo; PCBs over some serial bus.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.front-pcb-4.webp alt="Sorry for the glare. There's a lot of flux residue on this PCB."><figcaption><p>Sorry for the glare. There's a lot of flux residue on this PCB.</p></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.front-pcb-3.webp alt="Notice how at least 4 of the pins from the ribbon cable connector are note soldered to the PCB..."><figcaption><p>Notice how at least 4 of the pins from the ribbon cable connector are note soldered to the PCB...</p></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.front-pcb-2.webp alt="This PCB is means to be used in other SKUs that come with two extra buttons that are unpopulated here."><figcaption><p>This PCB is means to be used in other SKUs that come with two extra buttons that are unpopulated here.</p></figcaption></figure><h3 id=the-lan-module>The LAN module</h3><p>Very simple / standalone module. There&rsquo;s a dedicated PHY (<code>CH395Q</code>) and the same <code>STM8S003F3</code> micro controller again. The documentation that I received from the seller indicated that the LAN module did NOT use DHCP and there didn&rsquo;t seem to be a way to change the IP address configuration so I didn&rsquo;t bother with trying to automate via LAN.</p><p>Only after I made it most of the way through the ESPHome integration development did the seller provide <em>additional</em> documentation that indicates the IP address <em>can</em> be changed&mldr; but only if you use a Windows program.
I opted to keep going with the ESPHome &lt;-> RS232 integration as that would be the most flexible and accessible approach.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.lan-ic.webp><figcaption></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.lan.webp alt="The small LAN pcb is attached directly to the front panel with screws mating with some 90 degree flanges soldered to the PCB"><figcaption><p>The small LAN pcb is attached directly to the front panel with screws mating with some 90 degree flanges soldered to the PCB</p></figcaption></figure><h2 id=hdmi>HDMI</h2><p>In addition to the HDMI switching duties, the HDMI PCB hosts the UART electronics:</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.hdmi.uart.webp><figcaption></figcaption></figure><p>TTL to RS232 handled by the <code>SIPEX SP3223EEX</code>:</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.hdmi.uart.ic.webp><figcaption></figcaption></figure><p>The main application processor appears to be a STM32 clone known as the <code>CHIPSEA F031C8T6</code>.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.hdmi.main-cpu.webp><figcaption></figcaption></figure><p>Switching / routing the HDMI is done with two <code>IT66341TE</code> chips reducing the 4 HDMI inputs down to a single output and a <code>IT66321E</code> to switch between those two streams.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.hdmi.output-ic.webp alt="2 to 1 HDMI mux to switch between the two outputs from the 4 -> 1 muxes on board."><figcaption><p>2 to 1 HDMI mux to switch between the two outputs from the 4 -> 1 muxes on board.</p></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.hdmi.mux-1.webp alt="4 to 1 HDMI mux; one of two on the board"><figcaption><p>4 to 1 HDMI mux; one of two on the board</p></figcaption></figure><p>I would bet that the unpopulated connector in the bottom right is the bus connection to a second HDMI PCB in the 16 port model but I don&rsquo;t see where the differential pairs for the HDMI signal would come from so who knows ðŸ¤·.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.hdmi.mux-2.webp alt="4 to 1 HDMI mux; one of two on the board"><figcaption><p>4 to 1 HDMI mux; one of two on the board</p></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.hdmi.pcb-label.webp><figcaption></figcaption></figure><h2 id=usb>USB</h2><p>Like the HDMI PCB, the USB PCB uses a series of ASICs and a microprocessor to coordinate them all.
Near the 4 &lsquo;output&rsquo; USB ports, you can see the <code>CH559L</code> which runs the show. This IC is monitoring the USB bus for key codes from the keyboard for display switching purposes; press some key combination to switch inputs.</p><p>This is usually <code>PrtScrn</code> a few times quickly followed by the number of the input bank you wish to switch to.
I have not tested / verified this functionality but the seller does advertise that there is similar functionality</p><p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.usb.output.webp><figcaption></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.usb.main-cpu.webp><figcaption></figcaption></figure></p><p>Each &lsquo;input&rsquo; USB port is the same: unpopulated headphone jack footprint for audio input and a <code>FE1.1s USB 2.0 HUB</code> ASIC and an unknown IC that looks like it&rsquo;s related to the unpopulated headphone jack.</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.usb-port-2.webp alt="Each 'input' USB port is managed with the same IC. Note the unpopulated Headphone jack footprint on the PCB"><figcaption><p>Each 'input' USB port is managed with the same IC. Note the unpopulated Headphone jack footprint on the PCB</p></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.usb.hub-ic-closeup.webp alt="I can't make out the markings, but the 16 pin square IC is almost certainly an audio ID for the unpopulated headphone jack."><figcaption><p>I can't make out the markings, but the 16 pin square IC is almost certainly an audio ID for the unpopulated headphone jack.</p></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.usb-port.webp><figcaption></figcaption></figure><p>There&rsquo;s some generic 8:1 GPIO mux chips in the form of <code>3251QE</code>.
They are simple IO expanders that would allow a microcontroller to read/write 8 GPIO pins using just 3 GPIO.
I don&rsquo;t know why they&rsquo;re here or why an 8 port switch needs 2 of them&mldr; both on the USB PCB.</p><p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.usb.io-bus-mux.webp><figcaption></figcaption></figure><figure><img src=/hdmi-kvm-teardown-and-esphome/images/teardown.usb.io-bus-mux-closeup.webp><figcaption></figcaption></figure></p><p>That&rsquo;s it for teardown!</p><h3 id=dmesg><code>dmesg</code></h3><p>Just for completeness, here is how the KVM presents to the computer via USB.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>183000.909155<span class=o>]</span> usb 1-6: new high-speed USB device number <span class=m>63</span> using xhci_hcd
</span></span><span class=line><span class=cl><span class=o>[</span>183001.050545<span class=o>]</span> usb 1-6: New USB device found, <span class=nv>idVendor</span><span class=o>=</span>1a40, <span class=nv>idProduct</span><span class=o>=</span>0101, <span class=nv>bcdDevice</span><span class=o>=</span> 1.11
</span></span><span class=line><span class=cl><span class=o>[</span>183001.050550<span class=o>]</span> usb 1-6: New USB device strings: <span class=nv>Mfr</span><span class=o>=</span>0, <span class=nv>Product</span><span class=o>=</span>1, <span class=nv>SerialNumber</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>183001.050551<span class=o>]</span> usb 1-6: Product: USB 2.0 Hub
</span></span><span class=line><span class=cl><span class=o>[</span>183001.112333<span class=o>]</span> hub 1-6:1.0: USB hub found
</span></span><span class=line><span class=cl><span class=o>[</span>183001.112549<span class=o>]</span> hub 1-6:1.0: <span class=m>4</span> ports detected
</span></span><span class=line><span class=cl><span class=o>[</span>183001.495837<span class=o>]</span> usb 1-6.1: new high-speed USB device number <span class=m>64</span> using xhci_hcd
</span></span><span class=line><span class=cl><span class=o>[</span>183001.687327<span class=o>]</span> usb 1-6.1: New USB device found, <span class=nv>idVendor</span><span class=o>=</span>1a40, <span class=nv>idProduct</span><span class=o>=</span>0101, <span class=nv>bcdDevice</span><span class=o>=</span> 1.11
</span></span><span class=line><span class=cl><span class=o>[</span>183001.687332<span class=o>]</span> usb 1-6.1: New USB device strings: <span class=nv>Mfr</span><span class=o>=</span>0, <span class=nv>Product</span><span class=o>=</span>1, <span class=nv>SerialNumber</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>183001.687333<span class=o>]</span> usb 1-6.1: Product: USB 2.0 Hub
</span></span><span class=line><span class=cl><span class=o>[</span>183001.720379<span class=o>]</span> hub 1-6.1:1.0: USB hub found
</span></span><span class=line><span class=cl><span class=o>[</span>183001.720579<span class=o>]</span> hub 1-6.1:1.0: <span class=m>4</span> ports detected
</span></span><span class=line><span class=cl><span class=o>[</span>183001.912509<span class=o>]</span> usb 1-6.2: new low-speed USB device number <span class=m>65</span> using xhci_hcd
</span></span><span class=line><span class=cl><span class=o>[</span>183002.137295<span class=o>]</span> usb 1-6.2: New USB device found, <span class=nv>idVendor</span><span class=o>=</span>0c45, <span class=nv>idProduct</span><span class=o>=</span>7403, <span class=nv>bcdDevice</span><span class=o>=</span> 0.01
</span></span><span class=line><span class=cl><span class=o>[</span>183002.137300<span class=o>]</span> usb 1-6.2: New USB device strings: <span class=nv>Mfr</span><span class=o>=</span>1, <span class=nv>Product</span><span class=o>=</span>2, <span class=nv>SerialNumber</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>183002.137301<span class=o>]</span> usb 1-6.2: Product: USB Device
</span></span><span class=line><span class=cl><span class=o>[</span>183002.137303<span class=o>]</span> usb 1-6.2: Manufacturer: SONiX
</span></span><span class=line><span class=cl><span class=o>[</span>183002.239461<span class=o>]</span> input: SONiX USB Device as /devices/pci0000:00/0000:00:01.2/0000:02:00.0/0000:03:08.0/0000:05:00.1/usb1/1-6/1-6.2/1-6.2:1.0/0003:0C45:7403.00E4/input/input288
</span></span><span class=line><span class=cl><span class=o>[</span>183002.296065<span class=o>]</span> hid-generic 0003:0C45:7403.00E4: input,hidraw9: USB HID v1.00 Keyboard <span class=o>[</span>SONiX USB Device<span class=o>]</span> on usb-0000:05:00.1-6.2/input0
</span></span><span class=line><span class=cl><span class=o>[</span>183002.302457<span class=o>]</span> input: SONiX USB Device Mouse as /devices/pci0000:00/0000:00:01.2/0000:02:00.0/0000:03:08.0/0000:05:00.1/usb1/1-6/1-6.2/1-6.2:1.1/0003:0C45:7403.00E5/input/input289
</span></span><span class=line><span class=cl><span class=o>[</span>183002.302535<span class=o>]</span> input: SONiX USB Device System Control as /devices/pci0000:00/0000:00:01.2/0000:02:00.0/0000:03:08.0/0000:05:00.1/usb1/1-6/1-6.2/1-6.2:1.1/0003:0C45:7403.00E5/input/input290
</span></span><span class=line><span class=cl><span class=o>[</span>183002.359252<span class=o>]</span> hid-generic 0003:0C45:7403.00E5: input,hidraw10: USB HID v1.00 Mouse <span class=o>[</span>SONiX USB Device<span class=o>]</span> on usb-0000:05:00.1-6.2/input1
</span></span></code></pre></td></tr></table></div></div><p>And <code>lsusb</code> shows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=p>|</span>__ Port 6: Dev 63, If 0, <span class=nv>Class</span><span class=o>=</span>Hub, <span class=nv>Driver</span><span class=o>=</span>hub/4p, 480M
</span></span><span class=line><span class=cl>    ID 1a40:0101 Terminus Technology Inc. Hub
</span></span><span class=line><span class=cl>    /sys/bus/usb/devices/1-6  /dev/bus/usb/001/063
</span></span><span class=line><span class=cl>    <span class=p>|</span>__ Port 2: Dev 65, If 0, <span class=nv>Class</span><span class=o>=</span>Human Interface Device, <span class=nv>Driver</span><span class=o>=</span>usbhid, 1.5M
</span></span><span class=line><span class=cl>        ID 0c45:7403 Microdia Foot Switch
</span></span><span class=line><span class=cl>        /sys/bus/usb/devices/1-6.2  /dev/bus/usb/001/065
</span></span><span class=line><span class=cl>    <span class=p>|</span>__ Port 2: Dev 65, If 1, <span class=nv>Class</span><span class=o>=</span>Human Interface Device, <span class=nv>Driver</span><span class=o>=</span>usbhid, 1.5M
</span></span><span class=line><span class=cl>        ID 0c45:7403 Microdia Foot Switch
</span></span><span class=line><span class=cl>        /sys/bus/usb/devices/1-6.2  /dev/bus/usb/001/065
</span></span><span class=line><span class=cl>    <span class=p>|</span>__ Port 1: Dev 64, If 0, <span class=nv>Class</span><span class=o>=</span>Hub, <span class=nv>Driver</span><span class=o>=</span>hub/4p, 480M
</span></span><span class=line><span class=cl>        ID 1a40:0101 Terminus Technology Inc. Hub
</span></span><span class=line><span class=cl>        /sys/bus/usb/devices/1-6.1  /dev/bus/usb/001/064
</span></span></code></pre></td></tr></table></div></div><p>The <a href=http://blog.ssokolow.com/archives/2017/04/10/getting-your-cheap-chinese-usb-foot-pedal-doing-useful-things-on-linux/ target=_blank rel="noopener noreffer"><code>Microdia Foot Switch</code> bit</a> is odd.
Could that have something to do with the <code>3251QE</code> muxes?
Perhaps this device indicates to the computer weather or not it is the activated one? ðŸ¤” But why would you need two?</p><p>I did not dump <a href=https://en.wikipedia.org/wiki/Extended_Display_Identification_Data target=_blank rel="noopener noreffer"><code>EDID</code></a> information for the HDMI but I suspect that the switch is smart enough to just copy exactly what the display provides so the computers don&rsquo;t &lsquo;see&rsquo; the loss/change of a display which might re-arrange windows or adjust scaling.</p><h2 id=esphome-component>ESPHome component</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>The ESPHome component and some additional documentation/software/details are over at <a href=https://github.com/kquinsland/hdmi-kvm-esphome target=_blank rel="noopener noreffer"><code>kquinsland/hdmi-kvm-esphome</code></a>.</div></div></div><p>Yes, I wanted to be able to control this KVM from my Home Assistant install.
Some sort of API was a strong desire/requirement for KVM switches for a reason!</p><figure><img src=/hdmi-kvm-teardown-and-esphome/images/example_ha_conf.webp><figcaption></figcaption></figure><p>I am still working on a complementary ESPHome component to automate my standing desk (to be published soon!) but to give you an idea of the automations this KVM will be used in:</p><ul><li><p>Push a single button to:</p><ul><li>Turn on the VR computer</li><li>Switch KVM to the VR computer</li><li>Adjust the lighting as needed; turn most lights off as they&rsquo;re not needed with a VR headset on but turn on ambient lighting so the room isn&rsquo;t pitch dark when the headset is removed.</li></ul></li><li><p>When personal/work computer are not in use, switch to a host running Grafana dashboards on rotation</p></li><li><p>Allow me to track how much time per week is spent with each host</p></li></ul><h2 id=ics-and-distinguishing-markings>ICs and distinguishing markings</h2><p>The front panel PCB is labeled: <code>20170622</code> and features:</p><ul><li><a href=https://github.com/kquinsland/hdmi-kvm-esphome/blob/main/docs/datasheets/stm8s003f3.pdf target=_blank rel="noopener noreffer"><code>8S003F3P6</code></a> - A cheapish 8 bit micro controller.</li></ul><p>The LAN module PCB is marked with <code>20151030</code> and features:\</p><ul><li><a href=https://github.com/kquinsland/hdmi-kvm-esphome/blob/main/docs/datasheets/stm8s003f3.pdf target=_blank rel="noopener noreffer"><code>8S003F3P6</code></a> - The same micro used on the front panel</li><li><a href=https://github.com/kquinsland/hdmi-kvm-esphome/blob/main/docs/datasheets/2009031206_WCH-Jiangsu-Qin-Heng-CH395Q_C87390.pdf target=_blank rel="noopener noreffer"><code>CH395Q</code></a> - A dedicated ethernet interface.</li></ul><p>The HDMI PCB is populated with:</p><ul><li><p><a href="https://www.google.com/search?q=CHIPSEA+F031C8T6" target=_blank rel="noopener noreffer"><code>CHIPSEA F031C8T6</code></a> - STM32 clone; likely the main applications processor. I can&rsquo;t find a datasheet on this specific on the english speaking web but the naming is oddly similar to how some STM32 processors are named.</p></li><li><p><a href=https://github.com/kquinsland/hdmi-kvm-esphome/blob/main/docs/datasheets/sp3222_3232e.pdf target=_blank rel="noopener noreffer"><code>SIPEX SP3223EEX</code></a> - Basic TTL &lt;-> RS232 chip, similar to MAX232.</p></li><li><p><a href="https://www.ite.com.tw/en/product/view?mid=100" target=_blank rel="noopener noreffer"><code>IT66321E</code></a> - 2 IN to 1 OUT HDMI2.0 18Gb/s Switch with Audio In/Out</p></li><li><p><a href="https://www.ite.com.tw/en/product/view?mid=99" target=_blank rel="noopener noreffer"><code>IT66341TE</code></a> - 4 IN to 1 OUT HDMI2.0 18Gb/s Switch with Audio In/Out</p></li><li><p>A sticker with the markings:</p><blockquote><p>XUFUNG
33.01.0072
2012020074</p></blockquote></li><li><p>The PCB is marked with:</p><blockquote><p>HK20801AU
32.02.0119
BJ</p></blockquote></li></ul><p>The USB PCB is marked with <code>HK20801A30-KVM</code> and is populated with:</p><ul><li><a href=https://github.com/kquinsland/hdmi-kvm-esphome/blob/main/docs/datasheets/PI5C3251QE-datasheetz.pdf target=_blank rel="noopener noreffer"><code>PI5C 3251QE</code></a> - 8:1 Mux/DeMux BusSwitch</li><li><a href=https://github.com/kquinsland/hdmi-kvm-esphome/blob/main/docs/datasheets//2008191807_WCH-Jiangsu-Qin-Heng-CH559L_C150548 target=_blank rel="noopener noreffer"><code>CH559L</code></a> - 8 bit enhanced USB MCU CH559</li><li><a href=https://github.com/kquinsland/hdmi-kvm-esphome/blob/main/docs/datasheets/FE1.1s%2BData%2BSheet%2B%28Rev.%2B1.0%29.pdf target=_blank rel="noopener noreffer"><code>FE1.1s</code></a> - FE1.1S USB 2.0 HIGH SPEED 4-PORT HUB CONTROLLER</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-04-16</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/hdmi-kvm-teardown-and-esphome/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/esphome/>Esphome</a>,&nbsp;<a href=/tags/home-assistant/>Home-Assistant</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/xaomi-s1-monitor-lamp-teardown-and-tasmota/ class=prev rel=prev title="Installing Tasmota on the Xiaomi Desk Lamp"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Installing Tasmota on the Xiaomi Desk Lamp</a>
<a href=/venstar-t7850-teardown-review/ class=next rel=next title="Quick look inside Venstar T7850 - One of the only 'no-cloud' WiFi Thermostats that plays nice with Home Assistant">Quick look inside Venstar T7850 - One of the only 'no-cloud' WiFi Thermostats that plays nice with Home Assistant<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Â¯\_(ãƒ„)_/Â¯</div><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.152.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>karl</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.76e39bd605d45b2d1944123c66608b0c8bb9baeb70720b212571531c7cf9bc2a.css integrity="sha256-duOb1gXUWy0ZRBI8ZmCLDIu5uutwcgshJXFTHHz5vCo="><script type=text/javascript src=/lib/autocomplete/autocomplete.min.ae2da1bd62c6469ee27770ad1cddf2e8296d8a7f6d85b091463e5200c5e320af.js integrity="sha256-ri2hvWLGRp7id3CtHN3y6Cltin9thbCRRj5SAMXjIK8="></script><script type=text/javascript src=/lib/lunr/lunr.min.08a93c0120364b01159db3c287f39b2180bb740334472bda0675bd3f18981676.js integrity="sha256-CKk8ASA2SwEVnbPCh/ObIYC7dAM0RyvaBnW9PxiYFnY="></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.3d9120fa621da6d613c1698b7014ec6bdf4620366e8f2b7b547059f4b6f6272b.js integrity="sha256-PZEg+mIdptYTwWmLcBTsa99GIDZujyt7VHBZ9Lb2Jys="></script><script type=text/javascript src=/lib/clipboard/clipboard.min.e17a1d816e13c0826e0ed7febfabc3277f45571234bde0bf9120829a7169edc9.js integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck="></script><script type=text/javascript src=/lib/katex/katex.min.eb18207487161674e717087c317db14ac1a62dadaecccb802499ce173bfeb739.js integrity="sha256-6xggdIcWFnTnFwh8MX2xSsGmLa2uzMuAJJnOFzv+tzk="></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.cb7f4ca60ed5dc3e258415f8c7a3b46d4a93578a52adf83011f18a7f190e7602.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.52ce78fab4860d24ef22128a52ce24ca01368a9034457a565a1d3fccbab0ddbb.js integrity="sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.5c0a121a8b490afc85860a522347aeb34fb508c6b23044e5d29f6b2194227b51.js integrity="sha256-XAoSGotJCvyFhgpSI0eus0+1CMayMETl0p9rIZQie1E="></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.612a51a43205bbcf3b4af348dc2e8aa60f77f4fe5535ebc57f13054b61607d6c.js integrity="sha256-YSpRpDIFu887SvNI3C6Kpg939P5VNevFfxMFS2FgfWw="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3WZ55XG701",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-3WZ55XG701" async></script></body></html>